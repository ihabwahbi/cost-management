(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[902],{98015:function(e,s,t){Promise.resolve().then(t.bind(t,64322))},64322:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ea}});var a=t(2562),r=t(53121),n=t(43525),l=t(70386),i=t(66237),o=t(77726),d=t(55107),c=t(10516),m=t(61997),u=t(34020),x=t(25588),p=t(99729),h=t(45309),g=t(62074),j=t(23164),f=t(15255),b=t(71202);function v(){let e=(0,x._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return v=function(){return e},e}function N(){let e=(0,x._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return N=function(){return e},e}function _(e){let{className:s,classNames:t,showOutsideDays:r=!0,captionLayout:n="label",buttonVariant:l="ghost",formatters:i,components:o,...d}=e,c=(0,j.U)();return(0,a.jsx)(f._,{showOutsideDays:r,className:(0,b.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(v()),String.raw(N()),s),captionLayout:n,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...i},classNames:{root:(0,b.cn)("w-fit",c.root),months:(0,b.cn)("flex gap-4 flex-col md:flex-row relative",c.months),month:(0,b.cn)("flex flex-col w-full gap-4",c.month),nav:(0,b.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",c.nav),button_previous:(0,b.cn)((0,m.d)({variant:l}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",c.button_previous),button_next:(0,b.cn)((0,m.d)({variant:l}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",c.button_next),month_caption:(0,b.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",c.month_caption),dropdowns:(0,b.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",c.dropdowns),dropdown_root:(0,b.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",c.dropdown_root),dropdown:(0,b.cn)("absolute bg-popover inset-0 opacity-0",c.dropdown),caption_label:(0,b.cn)("select-none font-medium","label"===n?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",c.caption_label),table:"w-full border-collapse",weekdays:(0,b.cn)("flex",c.weekdays),weekday:(0,b.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",c.weekday),week:(0,b.cn)("flex w-full mt-2",c.week),week_number_header:(0,b.cn)("select-none w-(--cell-size)",c.week_number_header),week_number:(0,b.cn)("text-[0.8rem] select-none text-muted-foreground",c.week_number),day:(0,b.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",c.day),range_start:(0,b.cn)("rounded-l-md bg-accent",c.range_start),range_middle:(0,b.cn)("rounded-none",c.range_middle),range_end:(0,b.cn)("rounded-r-md bg-accent",c.range_end),today:(0,b.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",c.today),outside:(0,b.cn)("text-muted-foreground aria-selected:text-muted-foreground",c.outside),disabled:(0,b.cn)("text-muted-foreground opacity-50",c.disabled),hidden:(0,b.cn)("invisible",c.hidden),...t},components:{Root:e=>{let{className:s,rootRef:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"calendar",ref:t,className:(0,b.cn)(s),...r})},Chevron:e=>{let{className:s,orientation:t,...r}=e;return"left"===t?(0,a.jsx)(p.Z,{className:(0,b.cn)("size-4",s),...r}):"right"===t?(0,a.jsx)(h.Z,{className:(0,b.cn)("size-4",s),...r}):(0,a.jsx)(g.Z,{className:(0,b.cn)("size-4",s),...r})},DayButton:y,WeekNumber:e=>{let{children:s,...t}=e;return(0,a.jsx)("td",{...t,children:(0,a.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:s})})},...o},...d})}function y(e){let{className:s,day:t,modifiers:n,...l}=e,i=(0,j.U)(),o=r.useRef(null);return r.useEffect(()=>{var e;n.focused&&(null===(e=o.current)||void 0===e||e.focus())},[n.focused]),(0,a.jsx)(m.z,{ref:o,variant:"ghost",size:"icon","data-day":t.date.toLocaleDateString(),"data-selected-single":n.selected&&!n.range_start&&!n.range_end&&!n.range_middle,"data-range-start":n.range_start,"data-range-end":n.range_end,"data-range-middle":n.range_middle,className:(0,b.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",i.day,s),...l})}var w=t(88300);function k(e){let{...s}=e;return(0,a.jsx)(w.fC,{"data-slot":"popover",...s})}function C(e){let{...s}=e;return(0,a.jsx)(w.xz,{"data-slot":"popover-trigger",...s})}function S(e){let{className:s,align:t="center",sideOffset:r=4,...n}=e;return(0,a.jsx)(w.h_,{children:(0,a.jsx)(w.VY,{"data-slot":"popover-content",align:t,sideOffset:r,className:(0,b.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",s),...n})})}let z=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),(0,a.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,a.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,a.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})},P=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})},M=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("polyline",{points:"1,4 1,10 7,10"}),(0,a.jsx)("path",{d:"M3.51,15a9,9,0,0,0,2.13,3.09,9,9,0,0,0,13.37,0,9,9,0,0,0,0-12.72,9,9,0,0,0-9.9-1.92L3.51,9"})]})},D=e=>e.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}),O=()=>{let e=new Date,s=new Date(e);s.setDate(s.getDate()-1);let t=new Date(e);t.setDate(t.getDate()-7);let a=new Date(e);a.setDate(a.getDate()-30);let r=new Date(e);r.setDate(r.getDate()-90);let n=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()-1,1),i=new Date(e.getFullYear(),e.getMonth(),0),o=new Date(e.getFullYear(),3*Math.floor(e.getMonth()/3),1),d=new Date(e.getFullYear(),0,1);return{recent:[{label:"Today",range:{from:e,to:e}},{label:"Yesterday",range:{from:s,to:s}},{label:"Last 7 days",range:{from:t,to:e}},{label:"Last 30 days",range:{from:a,to:e}}],periods:[{label:"This month",range:{from:n,to:e}},{label:"Last month",range:{from:l,to:i}},{label:"This quarter",range:{from:o,to:e}},{label:"This year",range:{from:d,to:e}}]}};function B(e){let{onFilterChange:s}=e,[t,n]=(0,r.useState)("all"),[l,x]=(0,r.useState)(!1),[p,h]=(0,r.useState)("all"),[g,j]=(0,r.useState)(""),[f,v]=(0,r.useState)(),[N,y]=(0,r.useState)(null),w=O(),B=()=>{let e={location:"all"===t?void 0:t,fmtPo:!!l||void 0,mappingStatus:"all"===p?void 0:p,poNumbers:g,dateRange:f};console.log("[v0] Filter values:",e),s(e)};(0,r.useEffect)(()=>{B()},[t,l,p,g,f]);let L=e=>{switch(e){case"location":n("all");break;case"fmtPo":x(!1);break;case"mappingStatus":h("all");break;case"poNumbers":j("");break;case"dateRange":v(void 0),y(null)}},F=e=>{v(e.range),y(e.label)},A=(()=>{let e=[];if("all"!==t&&e.push({key:"location",label:"Location: ".concat(t),value:t}),l&&e.push({key:"fmtPo",label:"FMT PO Only",value:l}),"all"!==p&&e.push({key:"mappingStatus",label:"Status: ".concat(p),value:p}),g.trim()&&e.push({key:"poNumbers",label:"PO Numbers",value:g}),(null==f?void 0:f.from)||(null==f?void 0:f.to)){let s=N||"Custom range";e.push({key:"dateRange",label:s,value:f})}return e})();return(0,a.jsxs)(i.Zb,{className:"h-full rounded-none border-0 border-r bg-slate-50/50",children:[(0,a.jsxs)(i.Ol,{className:"pb-4 border-b bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(i.ll,{className:"text-lg font-semibold text-slate-900",children:"Filters"}),A.length>0&&(0,a.jsxs)(u.C,{variant:"secondary",className:"bg-blue-100 text-blue-700 font-medium",children:[A.length," active"]})]}),A.length>0&&(0,a.jsxs)("div",{className:"space-y-2 pt-3",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map(e=>(0,a.jsxs)(u.C,{variant:"outline",className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100 transition-colors cursor-pointer group",onClick:()=>L(e.key),children:[(0,a.jsx)("span",{className:"text-xs font-medium",children:e.label}),(0,a.jsx)(P,{className:"ml-1 h-3 w-3 group-hover:text-blue-900"})]},e.key))}),(0,a.jsxs)(m.z,{variant:"ghost",size:"sm",onClick:()=>{n("all"),x(!1),h("all"),j(""),v(void 0),y(null)},className:"h-7 px-2 text-xs text-slate-600 hover:text-slate-900 hover:bg-slate-100",children:[(0,a.jsx)(M,{className:"mr-1 h-3 w-3"}),"Clear all"]})]})]}),(0,a.jsxs)(i.aY,{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(o._,{htmlFor:"date-range",className:"text-sm font-medium text-slate-700",children:"PO Creation Date"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Recent"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:w.recent.map(e=>(0,a.jsx)(m.z,{variant:"outline",size:"sm",onClick:()=>F(e),className:(0,b.cn)("h-9 text-xs font-medium transition-all border-slate-200 hover:border-blue-300 hover:bg-blue-50",N===e.label?"bg-blue-100 border-blue-400 text-blue-700 shadow-sm":"text-slate-600 hover:text-blue-600"),children:e.label},e.label))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Periods"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:w.periods.map(e=>(0,a.jsx)(m.z,{variant:"outline",size:"sm",onClick:()=>F(e),className:(0,b.cn)("h-9 text-xs font-medium transition-all border-slate-200 hover:border-blue-300 hover:bg-blue-50",N===e.label?"bg-blue-100 border-blue-400 text-blue-700 shadow-sm":"text-slate-600 hover:text-blue-600"),children:e.label},e.label))})]}),(0,a.jsxs)("div",{className:"pt-3 border-t border-slate-200",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide mb-2",children:"Custom Range"}),(0,a.jsxs)(k,{children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsxs)(m.z,{id:"date-range",variant:"outline",className:(0,b.cn)("w-full justify-start text-left font-normal h-10 transition-all border-slate-200",!f&&"text-slate-500 hover:border-blue-300 hover:bg-blue-50",f&&!N&&"border-blue-400 bg-blue-100 text-blue-700 shadow-sm",N&&"border-slate-300 bg-slate-50 text-slate-600"),children:[(0,a.jsx)(z,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(null==f?void 0:f.from)?f.to?(0,a.jsxs)("div",{className:"truncate",children:[D(f.from)," - ",D(f.to)]}):(0,a.jsx)("div",{className:"truncate",children:D(f.from)}):(0,a.jsx)("span",{children:"Pick dates..."})}),N&&(0,a.jsx)("div",{className:"ml-2 flex-shrink-0",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})})]})}),(0,a.jsxs)(S,{className:"w-auto p-0",align:"start",children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-slate-50",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm text-slate-800 mb-1",children:"Custom Date Range"}),(0,a.jsx)("p",{className:"text-xs text-slate-600",children:"Select specific start and end dates"})]}),(0,a.jsx)(_,{initialFocus:!0,mode:"range",defaultMonth:null==f?void 0:f.from,selected:f,onSelect:e=>{v(e),y(null)},numberOfMonths:2,className:"p-3"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(o._,{htmlFor:"location",className:"text-sm font-medium text-slate-700",children:"Location"}),(0,a.jsxs)(d.Ph,{value:t,onValueChange:n,children:[(0,a.jsx)(d.i4,{className:(0,b.cn)("transition-all","all"!==t&&"border-blue-200 bg-blue-50/50"),children:(0,a.jsx)(d.ki,{placeholder:"Select location"})}),(0,a.jsxs)(d.Bw,{children:[(0,a.jsx)(d.Ql,{value:"all",children:"All Locations"}),(0,a.jsx)(d.Ql,{value:"Jandakot",children:"Jandakot"}),(0,a.jsx)(d.Ql,{value:"Perth",children:"Perth"}),(0,a.jsx)(d.Ql,{value:"Darwin",children:"Darwin"}),(0,a.jsx)(d.Ql,{value:"Karratha",children:"Karratha"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(o._,{className:"text-sm font-medium text-slate-700",children:"FMT PO"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"FMT PO Only"}),(0,a.jsx)("span",{className:"text-xs text-slate-500",children:"Show only FMT purchase orders"})]}),(0,a.jsx)("button",{onClick:()=>x(!l),className:(0,b.cn)("relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",l?"bg-blue-600":"bg-slate-200"),children:(0,a.jsx)("span",{className:(0,b.cn)("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",l?"translate-x-6":"translate-x-1")})})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(o._,{className:"text-sm font-medium text-slate-700",children:"Mapping Status"}),(0,a.jsx)("div",{className:"flex rounded-lg border border-slate-200 bg-slate-50 p-1",children:[{value:"all",label:"All"},{value:"mapped",label:"Mapped"},{value:"unmapped",label:"Unmapped"}].map(e=>(0,a.jsx)("button",{onClick:()=>h(e.value),className:(0,b.cn)("flex-1 px-3 py-2 text-sm font-medium rounded-md transition-all",p===e.value?"bg-white text-blue-700 shadow-sm border border-blue-200":"text-slate-600 hover:text-slate-900 hover:bg-white/50"),children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(o._,{htmlFor:"po-numbers",className:"text-sm font-medium text-slate-700",children:"PO Numbers"}),(0,a.jsx)(c.g,{id:"po-numbers",placeholder:"Paste PO numbers (one per line or comma-separated)",value:g,onChange:e=>j(e.target.value),className:(0,b.cn)("min-h-[80px] resize-none transition-all",g.trim()&&"border-blue-200 bg-blue-50/50")})]}),0===A.length&&(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsxs)("div",{className:"text-slate-400 text-sm",children:[(0,a.jsx)("svg",{className:"mx-auto h-8 w-8 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})}),"No filters applied"]})})]})]})}var L=t(37155),F=t.n(L),A=t(23482),V=t(92240),Z=t(48822);function E(e){let{className:s,...t}=e;return(0,a.jsx)(V.fC,{"data-slot":"checkbox",className:(0,b.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:(0,a.jsx)(V.z$,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(Z.Z,{className:"size-3.5"})})})}let q=e=>{let{className:s}=e;return(0,a.jsx)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("polyline",{points:"6,9 12,15 18,9"})})},Y=e=>{let{className:s}=e;return(0,a.jsx)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("polyline",{points:"9,18 15,12 9,6"})})},R=e=>{let{className:s}=e;return(0,a.jsx)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},T=e=>{let{className:s}=e;return(0,a.jsx)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})};function U(e){let{pos:s,selectedPO:t,selectedPOs:n,onPOSelect:l,onPOsSelection:o}=e,[d,c]=(0,r.useState)(new Set),x=e=>{let s=new Set(d);s.has(e)?s.delete(e):s.add(e),c(s)},p=(e,s)=>{s?o([...n,e]):o(n.filter(s=>s!==e))},h=e=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),g=e=>new Date(e).toLocaleDateString("en-AU",{day:"2-digit",month:"short",year:"numeric"}),j=e=>{var s;return e.mapped_count===e.total_line_items&&(null!==(s=e.total_line_items)&&void 0!==s?s:0)>0},f=s.length>0&&n.length===s.length,v=n.length>0&&n.length<s.length;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F(),{id:"c1c6f80e03284a25",children:".fmt-status-yes.jsx-c1c6f80e03284a25{background-color:#0014DC!important;color:#fff!important}.fmt-status-no.jsx-c1c6f80e03284a25{background-color:#f3f4f6!important;color:#374151!important}"}),(0,a.jsxs)(i.Zb,{className:"h-full rounded-none border-0 border-r",children:[(0,a.jsxs)(i.Ol,{className:"pb-4",children:[(0,a.jsx)(i.ll,{className:"text-lg font-semibold",children:"PO Mapping"}),(0,a.jsx)("p",{className:"jsx-c1c6f80e03284a25 text-sm text-muted-foreground",children:"Map purchase orders to project..."})]}),(0,a.jsx)(i.aY,{className:"p-0",children:(0,a.jsx)("div",{className:"jsx-c1c6f80e03284a25 overflow-auto h-[calc(100vh-200px)]",children:(0,a.jsxs)(A.iA,{children:[(0,a.jsx)(A.xD,{className:"sticky top-0 bg-card z-10",children:(0,a.jsxs)(A.SC,{children:[(0,a.jsx)(A.ss,{className:"w-12",children:(0,a.jsx)(E,{checked:f,onCheckedChange:e=>{e?o(s.map(e=>e.id)):o([])},ref:e=>{e&&(e.indeterminate=v)}})}),(0,a.jsx)(A.ss,{className:"w-12"}),(0,a.jsx)(A.ss,{children:"PO Number"}),(0,a.jsx)(A.ss,{children:"Vendor Name"}),(0,a.jsx)(A.ss,{children:"Total Value"}),(0,a.jsx)(A.ss,{children:"Creation Date"}),(0,a.jsx)(A.ss,{children:"Location"}),(0,a.jsx)(A.ss,{children:"FMT PO"}),(0,a.jsx)(A.ss,{children:"Mapping Status"})]})}),(0,a.jsx)(A.RM,{children:s.map(e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(A.SC,{className:(0,b.cn)("cursor-pointer hover:bg-muted/50",(null==t?void 0:t.id)===e.id&&"bg-accent/10 border-l-4 border-l-primary"),onClick:()=>l(e),children:[(0,a.jsx)(A.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(E,{checked:n.includes(e.id),onCheckedChange:s=>p(e.id,s)})}),(0,a.jsx)(A.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsx)(m.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>x(e.id),children:d.has(e.id)?(0,a.jsx)(q,{className:"h-4 w-4"}):(0,a.jsx)(Y,{className:"h-4 w-4"})})}),(0,a.jsx)(A.pj,{className:"font-medium",children:e.po_number}),(0,a.jsx)(A.pj,{children:e.vendor_name}),(0,a.jsx)(A.pj,{className:"text-right font-medium",children:h(e.total_value)}),(0,a.jsx)(A.pj,{className:"text-sm text-muted-foreground",children:g(e.po_creation_date)}),(0,a.jsx)(A.pj,{children:e.location}),(0,a.jsx)(A.pj,{children:(0,a.jsx)("span",{className:"jsx-c1c6f80e03284a25 "+((0,b.cn)("inline-flex items-center justify-center rounded-md px-2 py-0.5 text-xs font-medium",e.fmt_po?"fmt-status-yes":"fmt-status-no")||""),children:e.fmt_po?"Yes":"No"})}),(0,a.jsx)(A.pj,{children:j(e)?(0,a.jsxs)("div",{className:"jsx-c1c6f80e03284a25 inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-green-100 text-green-800 border border-green-200",children:[(0,a.jsx)(R,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"jsx-c1c6f80e03284a25 text-xs font-medium",children:"Mapped"})]}):(0,a.jsxs)("div",{className:"jsx-c1c6f80e03284a25 inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-red-50 text-red-700 border border-red-200",children:[(0,a.jsx)(T,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"jsx-c1c6f80e03284a25 text-xs font-medium",children:"Not Mapped"})]})})]},e.id),d.has(e.id)&&(0,a.jsx)(a.Fragment,{children:e.line_items.map(e=>(0,a.jsxs)(A.SC,{className:"bg-muted/20",children:[(0,a.jsx)(A.pj,{}),(0,a.jsx)(A.pj,{}),(0,a.jsxs)(A.pj,{className:"text-sm font-medium pl-8",children:["Line ",e.line_item_number]}),(0,a.jsx)(A.pj,{className:"text-sm",children:e.part_number}),(0,a.jsx)(A.pj,{className:"text-right text-sm",children:h(e.line_value)}),(0,a.jsx)(A.pj,{className:"text-sm text-muted-foreground",children:e.description}),(0,a.jsxs)(A.pj,{className:"text-sm",children:[e.quantity," ",e.uom]}),(0,a.jsx)(A.pj,{}),(0,a.jsx)(A.pj,{children:e.is_mapped?(0,a.jsx)(u.C,{variant:"secondary",className:"text-xs",children:"Mapped"}):(0,a.jsx)(u.C,{variant:"outline",className:"text-xs text-muted-foreground",children:"Unmapped"})})]},e.id))})]}))})]})})})]})]})}var H=t(5660),Q=t(62680);let W=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{d:"M19,21H5a2,2,0,0,1-2-2V5a2,2,0,0,1,2-2H16l3,3V19A2,2,0,0,1,19,21Z"}),(0,a.jsx)("polyline",{points:"17,21 17,13 7,13 7,21"}),(0,a.jsx)("polyline",{points:"7,3 7,8 15,8"})]})},I=e=>{let{className:s}=e;return(0,a.jsx)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M21,15a2,2,0,0,1-2,2H7l-4,4V5a2,2,0,0,1,2-2H19a2,2,0,0,1,2,2Z"})})},G=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2,0,0,0 2 2H14a2 2 0,0,0 2-2V7"}),(0,a.jsx)("path",{d:"m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})},J=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),(0,a.jsx)("polyline",{points:"22,4 12,14.01 9,11.01"})]})},K=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{d:"m3 6 3 0"}),(0,a.jsx)("path",{d:"m6 6 0 14c0 1-1 2-2 2h8c1 0 2-1 2-2V6"}),(0,a.jsx)("path",{d:"m8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),(0,a.jsx)("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),(0,a.jsx)("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]})};function $(e){let{selectedPO:s,costBreakdowns:t,onSaveMapping:n,onMappingChange:l}=e,[x,p]=(0,r.useState)(""),[h,g]=(0,r.useState)(""),[j,f]=(0,r.useState)(""),[b,v]=(0,r.useState)(""),[N,_]=(0,r.useState)([]),[y,w]=(0,r.useState)(!1),[k,C]=(0,r.useState)([]),[S,z]=(0,r.useState)([]),[P,M]=(0,r.useState)([]),[D,O]=(0,r.useState)([]),[B,L]=(0,r.useState)(null),[F,A]=(0,r.useState)(""),[V,Z]=(0,r.useState)(""),[E,q]=(0,r.useState)(""),[Y,R]=(0,r.useState)(""),[T,U]=(0,r.useState)(!1),[$,X]=(0,r.useState)(!1),[ee,es]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1),er=(0,Q.e)();(0,r.useEffect)(()=>{en()},[]),(0,r.useEffect)(()=>{s&&(ed(s.id),p(""),g(""),f(""),v(""))},[s]),(0,r.useEffect)(()=>{x&&(el(x),g(""),f(""))},[x]),(0,r.useEffect)(()=>{x&&h&&(ei(x,h),f(""))},[x,h]),(0,r.useEffect)(()=>{x&&h&&j&&eo()},[x,h,j]);let en=async()=>{try{let{data:e,error:s}=await er.from("projects").select("id, name, sub_business_line").order("name");if(s)throw s;C(e||[])}catch(e){console.error("Error fetching projects:",e)}},el=async e=>{try{let{data:s,error:t}=await er.from("cost_breakdown").select("spend_type").eq("project_id",e).order("spend_type");if(t)throw t;let a=Array.from(new Set((null==s?void 0:s.map(e=>e.spend_type))||[])).map(e=>({spend_type:e}));z(a)}catch(e){console.error("Error fetching spend types:",e)}},ei=async(e,s)=>{try{let{data:t,error:a}=await er.from("cost_breakdown").select("spend_sub_category").eq("project_id",e).eq("spend_type",s).order("spend_sub_category");if(a)throw a;let r=Array.from(new Set((null==t?void 0:t.map(e=>e.spend_sub_category))||[])).map(e=>({spend_sub_category:e}));M(r)}catch(e){console.error("Error fetching spend sub categories:",e)}},eo=async()=>{try{let{data:e,error:s}=await er.from("cost_breakdown").select("\n          *,\n          project:projects(name)\n        ").eq("project_id",x).eq("spend_type",h).eq("spend_sub_category",j);if(s)throw s;O(e||[])}catch(e){console.error("Error finding cost breakdown:",e)}},ed=async e=>{try{let{data:s,error:t}=await er.from("po_mappings").select("\n          *,\n          cost_breakdown:cost_breakdown(\n            *,\n            project:projects(name)\n          ),\n          po_line_item:po_line_items!inner(\n            id,\n            po_id\n          )\n        ").eq("po_line_item.po_id",e);if(t)throw t;let a=(s||[]).reduce((e,s)=>{let t=e.find(e=>e.cost_breakdown.id===s.cost_breakdown.id);return t?t.mappings.push(s):e.push({...s,mappings:[s]}),e},[]);_(a),U(a.length>0)}catch(e){console.error("Error fetching existing mappings:",e)}},ec=async()=>{s&&D.length>0&&(w(!0),await n(s.id,D[0].id,b)&&(await ed(s.id),l&&await l(),p(""),g(""),f(""),v(""),X(!1)),w(!1))},em=async e=>{if(F&&V&&E){w(!0);try{let{data:t,error:a}=await er.from("cost_breakdown").select("id").eq("project_id",F).eq("spend_type",V).eq("spend_sub_category",E).single();if(a)throw a;let r=e.mappings.map(e=>er.from("po_mappings").update({cost_breakdown_id:t.id,mapping_notes:Y}).eq("id",e.id));await Promise.all(r),await ed(s.id),l&&await l(),L(null),A(""),Z(""),q(""),R("")}catch(e){console.error("Error updating mapping:",e)}w(!1)}},eu=async()=>{if(s){ea(!0);try{let{error:e}=await er.from("po_mappings").delete().in("po_line_item_id",s.line_items.map(e=>e.id));if(e)throw e;await ed(s.id),l&&await l(),es(!1)}catch(e){console.error("Error clearing mapping:",e)}ea(!1)}},ex=()=>{X(!0),p(""),g(""),f(""),v("")},ep=e=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return s?(0,a.jsxs)(i.Zb,{className:"h-full rounded-none border-0",children:[(0,a.jsx)(i.Ol,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(i.ll,{className:"text-lg font-semibold",children:["PO ",s.po_number]}),T&&!$&&(0,a.jsxs)(u.C,{variant:"default",className:"bg-green-100 text-green-800 border-green-200",children:[(0,a.jsx)(J,{className:"w-3 h-3 mr-1"}),"Mapped"]})]})}),(0,a.jsxs)(i.aY,{className:"space-y-6 overflow-auto h-[calc(100vh-200px)]",children:[!T&&!$&&(0,a.jsx)(i.Zb,{className:"border-2 border-dashed border-primary/20 bg-primary/5",children:(0,a.jsx)(i.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 mx-auto mb-3 bg-primary/10 rounded-full flex items-center justify-center",children:(0,a.jsx)(G,{className:"w-6 h-6 text-primary"})}),(0,a.jsx)("h3",{className:"font-medium text-primary mb-2",children:"PO Not Mapped"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"This Purchase Order hasn't been mapped to a project yet. Create a mapping to track costs properly."}),(0,a.jsxs)(m.z,{onClick:ex,className:"bg-primary hover:bg-primary/90",children:[(0,a.jsx)(G,{className:"mr-2 h-4 w-4"}),"Create Mapping"]})]})})}),!T&&$||T&&$?(0,a.jsxs)(i.Zb,{className:"border-2 border-dashed border-primary/20 bg-primary/5",children:[(0,a.jsx)(i.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(i.ll,{className:"text-base text-primary",children:T?"Update Mapping":"Create New Mapping"}),(0,a.jsx)(m.z,{variant:"ghost",size:"sm",onClick:()=>{X(!1),L(null),p(""),g(""),f(""),v(""),A(""),Z(""),q(""),R("")},children:"Cancel"})]})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"project",children:"Project"}),(0,a.jsxs)(d.Ph,{value:x,onValueChange:p,children:[(0,a.jsx)(d.i4,{children:(0,a.jsx)(d.ki,{placeholder:"Select project"})}),(0,a.jsx)(d.Bw,{children:k.map(e=>(0,a.jsx)(d.Ql,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"spend-type",children:"Spend Type"}),(0,a.jsxs)(d.Ph,{value:h,onValueChange:g,disabled:!x,children:[(0,a.jsx)(d.i4,{children:(0,a.jsx)(d.ki,{placeholder:x?"Select spend type":"Select project first"})}),(0,a.jsx)(d.Bw,{children:S.map(e=>(0,a.jsx)(d.Ql,{value:e.spend_type,children:e.spend_type},e.spend_type))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"spend-sub-category",children:"Spend Sub Category"}),(0,a.jsxs)(d.Ph,{value:j,onValueChange:f,disabled:!h,children:[(0,a.jsx)(d.i4,{children:(0,a.jsx)(d.ki,{placeholder:h?"Select spend sub category":"Select spend type first"})}),(0,a.jsx)(d.Bw,{children:P.map(e=>(0,a.jsx)(d.Ql,{value:e.spend_sub_category,children:e.spend_sub_category},e.spend_sub_category))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"mapping-notes",children:"Notes (Optional)"}),(0,a.jsx)(c.g,{id:"mapping-notes",placeholder:"Add notes about this mapping...",value:b,onChange:e=>v(e.target.value),className:"min-h-[60px] resize-none"})]}),(0,a.jsxs)(m.z,{onClick:ec,className:"w-full",disabled:!x||!h||!j||0===D.length||y,children:[(0,a.jsx)(W,{className:"mr-2 h-4 w-4"}),y?"Saving...":T?"Update Mapping":"Save Mapping"]})]})]}):null,T&&!$?(0,a.jsxs)(i.Zb,{className:"border-green-200 bg-green-50",children:[(0,a.jsx)(i.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(i.ll,{className:"text-base text-green-800",children:"Current Mapping"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsxs)(m.z,{onClick:ex,variant:"outline",size:"sm",className:"border-green-300 text-green-700 hover:bg-green-100 bg-transparent w-full",children:[(0,a.jsx)(G,{className:"mr-2 h-4 w-4"}),"Update Mapping"]}),(0,a.jsxs)(m.z,{onClick:()=>es(!0),variant:"outline",size:"sm",className:"border-red-300 text-red-700 hover:bg-red-50 bg-transparent w-full",children:[(0,a.jsx)(K,{className:"mr-2 h-4 w-4"}),"Clear Mapping"]})]})]})}),(0,a.jsxs)(i.aY,{children:[ee&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(K,{className:"w-4 h-4 text-red-600"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"font-medium text-red-800 mb-1",children:"Clear Mapping"}),(0,a.jsxs)("p",{className:"text-sm text-red-700 mb-3 break-words",children:["Are you sure you want to clear the mapping for PO ",s.po_number,"? This action cannot be undone."]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsx)(m.z,{onClick:eu,size:"sm",variant:"destructive",disabled:et,className:"w-full",children:et?"Clearing...":"Yes, Clear Mapping"}),(0,a.jsx)(m.z,{onClick:()=>es(!1),size:"sm",variant:"outline",className:"w-full",children:"Cancel"})]})]})]})}),(0,a.jsx)("div",{className:"space-y-3",children:N.map(e=>(0,a.jsx)("div",{className:"p-4 bg-white rounded-lg border border-green-200",children:B===e.id?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{children:"Project"}),(0,a.jsxs)(d.Ph,{value:F,onValueChange:A,children:[(0,a.jsx)(d.i4,{children:(0,a.jsx)(d.ki,{})}),(0,a.jsx)(d.Bw,{children:k.map(e=>(0,a.jsx)(d.Ql,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{children:"Spend Type"}),(0,a.jsxs)(d.Ph,{value:V,onValueChange:Z,children:[(0,a.jsx)(d.i4,{children:(0,a.jsx)(d.ki,{})}),(0,a.jsx)(d.Bw,{children:S.map(e=>(0,a.jsx)(d.Ql,{value:e.spend_type,children:e.spend_type},e.spend_type))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{children:"Spend Sub Category"}),(0,a.jsxs)(d.Ph,{value:E,onValueChange:q,children:[(0,a.jsx)(d.i4,{children:(0,a.jsx)(d.ki,{})}),(0,a.jsx)(d.Bw,{children:P.map(e=>(0,a.jsx)(d.Ql,{value:e.spend_sub_category,children:e.spend_sub_category},e.spend_sub_category))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{children:"Notes"}),(0,a.jsx)(c.g,{value:Y,onChange:e=>R(e.target.value),className:"min-h-[60px] resize-none"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(m.z,{size:"sm",onClick:()=>em(e),disabled:y,className:"w-full",children:y?"Saving...":"Save Changes"}),(0,a.jsx)(m.z,{size:"sm",variant:"outline",onClick:()=>L(null),className:"w-full",children:"Cancel"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 mb-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-800 mb-1 break-words",children:e.cost_breakdown.project.name}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(u.C,{variant:"secondary",className:"text-xs",children:e.cost_breakdown.spend_type}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"→"}),(0,a.jsx)(u.C,{variant:"secondary",className:"text-xs",children:e.cost_breakdown.spend_sub_category})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground break-words",children:[e.cost_breakdown.sub_business_line," -"," ",e.cost_breakdown.cost_line]})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(u.C,{variant:"outline",className:"text-sm font-semibold",children:ep(s.total_value)})})]}),e.mapping_notes&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs text-muted-foreground",children:[(0,a.jsx)("strong",{children:"Notes:"})," ",e.mapping_notes]})]})},e.id))})]})]}):null,(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{className:"pb-3",children:(0,a.jsx)(i.ll,{className:"text-base",children:"PO Details"})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"Total Value"}),(0,a.jsx)("p",{className:"font-medium",children:ep(s.total_value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"Creation Date"}),(0,a.jsx)("p",{className:"font-medium",children:(e=>{if(!e)return"N/A";let s=new Date(e);return isNaN(s.getTime())?"N/A":s.toLocaleDateString("en-AU",{day:"2-digit",month:"long",year:"numeric"})})(s.po_creation_date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"Vendor Name"}),(0,a.jsx)("p",{className:"font-medium",children:s.vendor_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"FMT PO"}),(0,a.jsx)(u.C,{variant:s.fmt_po?"default":"secondary",children:s.fmt_po?"Yes":"No"})]}),s.project_name&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"Current Project"}),(0,a.jsx)("p",{className:"font-medium",children:s.project_name})]}),s.asset_code&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"Asset Code"}),(0,a.jsx)(u.C,{variant:"outline",children:s.asset_code})]})]}),(0,a.jsx)(H.Z,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o._,{className:"text-muted-foreground mb-2 block",children:"Line Items"}),(0,a.jsx)("div",{className:"space-y-2",children:s.line_items.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 bg-muted/50 rounded",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:["Line ",e.line_item_number,": ",e.description]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Quantity: ",e.quantity]})]}),(0,a.jsx)("p",{className:"text-sm font-medium",children:isNaN(Number(e.line_value))||null==e.line_value?"N/A":ep(Number(e.line_value))})]},e.id))})]})]})]})]})]}):(0,a.jsx)(i.Zb,{className:"h-full rounded-none border-0",children:(0,a.jsx)(i.aY,{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("div",{className:"w-16 h-16 mx-auto bg-muted rounded-full flex items-center justify-center",children:(0,a.jsx)(I,{className:"w-8 h-8"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Select a PO to see details"}),(0,a.jsx)("p",{className:"text-sm",children:"Choose a Purchase Order from the table to view and edit its mapping details."})]})})})}let X=e=>{let{className:s}=e;return(0,a.jsx)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"})})},ee=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{d:"M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"}),(0,a.jsx)("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]})},es=e=>{let{className:s}=e;return(0,a.jsxs)("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})};function et(e){let{selectedCount:s,onAssignProject:t,onAssignSpendCategory:r,onClear:n}=e;return(0,a.jsx)(i.Zb,{className:"absolute bottom-4 left-4 right-4 border shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(u.C,{variant:"secondary",className:"px-3 py-1",children:[s," selected"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(m.z,{size:"sm",onClick:t,children:[(0,a.jsx)(X,{className:"mr-2 h-4 w-4"}),"Assign Project"]}),(0,a.jsxs)(m.z,{size:"sm",variant:"outline",onClick:r,children:[(0,a.jsx)(ee,{className:"mr-2 h-4 w-4"}),"Assign Spend Category"]})]})]}),(0,a.jsx)(m.z,{size:"sm",variant:"ghost",onClick:n,children:(0,a.jsx)(es,{className:"h-4 w-4"})})]})})}function ea(){let[e,s]=(0,r.useState)(null),[t,i]=(0,r.useState)([]),[o,d]=(0,r.useState)([]),[c,m]=(0,r.useState)([]),[u,x]=(0,r.useState)([]),[p,h]=(0,r.useState)(!0),g=(0,Q.e)(),j=async()=>{try{let{data:e,error:s}=await g.from("pos").select("*").order("po_creation_date",{ascending:!1});if(s)throw s;let{data:t,error:a}=await g.from("po_line_items").select("*").order("line_item_number",{ascending:!0});if(a)throw a;let{data:r,error:n}=await g.from("po_mappings").select("po_line_item_id");if(n)throw n;let l=new Set(r.map(e=>e.po_line_item_id)),i=e.map(e=>{let s=t.filter(s=>s.po_id===e.id).map(e=>({id:e.id,line_item_number:e.line_item_number,part_number:e.part_number,description:e.description,quantity:e.quantity,uom:e.uom,line_value:e.line_value,is_mapped:l.has(e.id)}));return{id:e.id,po_number:e.po_number,vendor_name:e.vendor_name,total_value:e.total_value,po_creation_date:e.po_creation_date,location:e.location,fmt_po:e.fmt_po,project_name:e.project_name||null,asset_code:e.asset_code||null,line_items:s,mapped_count:s.filter(e=>e.is_mapped).length,total_line_items:s.length}});m(i),d(i)}catch(e){console.error("Error fetching POs:",e)}},f=async()=>{try{let{data:e,error:s}=await g.from("cost_breakdown").select("\n          *,\n          project:projects(name)\n        ").order("created_at",{ascending:!1});if(s)throw s;x(e||[])}catch(e){console.error("Error fetching cost breakdowns:",e)}};(0,r.useEffect)(()=>{(async()=>{h(!0),await Promise.all([j(),f()]),h(!1)})()},[]);let b=async(e,s,t)=>{try{let a=c.find(s=>s.id===e);if(!a)throw Error("PO not found");let r=a.line_items.map(e=>g.from("po_mappings").upsert({po_line_item_id:e.id,cost_breakdown_id:s,mapped_amount:e.line_value,mapping_notes:t||null,mapped_by:"current_user"})),n=(await Promise.all(r)).filter(e=>e.error);if(n.length>0)throw n[0].error;return await j(),console.log("Mapping saved successfully"),!0}catch(e){return console.error("Error saving mapping:",e),!1}},v=async()=>{if(await j(),e){let t=c.find(s=>s.id===e.id);t&&s(t)}};return p?(0,a.jsx)(n.V,{children:(0,a.jsx)("div",{className:"h-[calc(100vh-4rem)] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading PO data..."})]})})}):(0,a.jsx)(n.V,{children:(0,a.jsx)("div",{className:"h-[calc(100vh-4rem)]",children:(0,a.jsxs)(l.pO,{direction:"horizontal",className:"h-full",children:[(0,a.jsx)(l.ee,{defaultSize:20,minSize:15,maxSize:30,children:(0,a.jsx)(B,{onFilterChange:e=>{var s,t;console.log("[v0] Applying filters:",e);let a=c;if(e.poNumbers&&e.poNumbers.trim()){let s=e.poNumbers.split(/[\n,\s]+/).filter(Boolean);a=a.filter(e=>s.some(s=>e.po_number.includes(s.trim())))}((null===(s=e.dateRange)||void 0===s?void 0:s.from)||(null===(t=e.dateRange)||void 0===t?void 0:t.to))&&(a=a.filter(s=>{let t=new Date(s.po_creation_date);return(!e.dateRange.from||!(t<e.dateRange.from))&&(!e.dateRange.to||!(t>e.dateRange.to))})),e.location&&"all"!==e.location&&(a=a.filter(s=>s.location.toLowerCase()===e.location.toLowerCase())),void 0!==e.fmtPo&&(a=a.filter(s=>s.fmt_po===e.fmtPo)),e.mappingStatus&&"all"!==e.mappingStatus&&("mapped"===e.mappingStatus?a=a.filter(e=>e.mapped_count&&e.mapped_count>0):"unmapped"===e.mappingStatus&&(a=a.filter(e=>!e.mapped_count||0===e.mapped_count))),console.log("[v0] Filtered POs count:",a.length),d(a)}})}),(0,a.jsx)(l.Dp,{withHandle:!0}),(0,a.jsx)(l.ee,{defaultSize:50,minSize:40,children:(0,a.jsxs)("div",{className:"relative h-full",children:[(0,a.jsx)(U,{pos:o,selectedPO:e,selectedPOs:t,onPOSelect:e=>{s(e)},onPOsSelection:e=>{i(e)}}),t.length>0&&(0,a.jsx)(et,{selectedCount:t.length,onAssignProject:()=>console.log("Assign project"),onAssignSpendCategory:()=>console.log("Assign spend category"),onClear:()=>i([])})]})}),(0,a.jsx)(l.Dp,{withHandle:!0}),(0,a.jsx)(l.ee,{defaultSize:30,minSize:25,maxSize:40,children:(0,a.jsx)($,{selectedPO:e,costBreakdowns:u,onSaveMapping:b,onMappingChange:v})})]})})})}},43525:function(e,s,t){"use strict";t.d(s,{V:function(){return g}});var a=t(2562),r=t(53121),n=t(35823),l=t(19122),i=t(71202),o=t(61997),d=t(64061),c=t(50248),m=t(94851),u=t(61089),x=t(45309),p=t(65968);let h=[{name:"Dashboard",href:"/",icon:d.Z,description:"Overview and key metrics"},{name:"PO Mapping",href:"/po-mapping",icon:c.Z,description:"Map purchase orders to projects"},{name:"Projects",href:"/projects",icon:m.Z,description:"Manage project budgets and costs"}];function g(e){let{children:s}=e,[t,d]=(0,r.useState)(!1),c=(0,l.usePathname)(),m=(()=>{let e=c.split("/").filter(Boolean),s=[{name:"Dashboard",href:"/"}];return e.length>0&&("po-mapping"===e[0]?s.push({name:"PO Mapping",href:"/po-mapping"}):"projects"===e[0]&&(s.push({name:"Projects",href:"/projects"}),"new"===e[1]&&s.push({name:"New Project",href:"/projects/new"}))),s})();return(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[t&&(0,a.jsx)("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:()=>d(!1)}),(0,a.jsx)("div",{className:(0,i.cn)("fixed inset-y-0 left-0 z-50 w-72 transform bg-card border-r border-border transition-transform duration-200 ease-in-out lg:translate-x-0",t?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsx)("div",{className:"border-b border-border",children:(0,a.jsxs)("div",{className:"quisitiveBrand",children:[(0,a.jsx)("div",{className:"quisitiveBrandImage",children:(0,a.jsx)("a",{className:"quisitiveBrandImageLink",title:"Our Brand","data-interception":"off",href:"https://slb001.sharepoint.com",target:"_blank",rel:"noopener noreferrer",children:(0,a.jsx)("img",{src:"/SLB_Logo_Positive_RGB_General.svg",alt:"SLB Logo"})})}),(0,a.jsxs)("div",{className:"flex-1 ml-4",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-card-foreground",children:"Cost Management Hub"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"For a Balanced Planet"})]})]})}),(0,a.jsx)("nav",{className:"flex-1 px-4 py-6 space-y-2",children:h.map(e=>{let s=c===e.href||"/"!==e.href&&c.startsWith(e.href);return(0,a.jsxs)(n.default,{href:e.href,className:(0,i.cn)("flex items-center gap-3 rounded-lg px-3 py-3 text-sm font-medium transition-colors",s?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:bg-accent/10 hover:text-accent-foreground"),onClick:()=>d(!1),children:[(0,a.jsx)(e.icon,{className:"h-5 w-5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-xs opacity-75",children:e.description})]})]},e.name)})}),(0,a.jsx)("div",{className:"border-t border-border p-4",children:(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,a.jsx)("div",{className:"font-medium",children:"SLB Cost Management"}),(0,a.jsx)("div",{children:"Version 1.0"})]})})]})}),(0,a.jsxs)("div",{className:"lg:pl-72",children:[(0,a.jsxs)("header",{className:"sticky top-0 z-30 flex h-16 items-center gap-4 border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60 px-6",children:[(0,a.jsx)(o.z,{variant:"ghost",size:"sm",className:"lg:hidden",onClick:()=>d(!0),children:(0,a.jsx)(u.Z,{className:"h-5 w-5"})}),(0,a.jsx)("nav",{className:"flex items-center space-x-1 text-sm text-muted-foreground",children:m.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[s>0&&(0,a.jsx)(x.Z,{className:"h-4 w-4 mx-1"}),(0,a.jsxs)(n.default,{href:e.href,className:(0,i.cn)("hover:text-foreground transition-colors",s===m.length-1&&"text-foreground font-medium"),children:[0===s&&(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-1"}),e.name]})]},e.href))}),(0,a.jsx)("div",{className:"ml-auto flex items-center gap-4",children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Welcome back, Resource Manager"})})]}),(0,a.jsx)("main",{className:"flex-1",children:s})]})]})}}},function(e){e.O(0,[197,22,316,813,354,90,811,208,945,744],function(){return e(e.s=98015)}),_N_E=e.O()}]);