(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[977],{69551:function(e,t,a){Promise.resolve().then(a.bind(a,5354))},5354:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return e_}});var s=a(2562),r=a(53121),n=a(62680),l=a(66237),i=a(60204),c=a(34020),o=a(29498),d=a(23943),u=a(79173),m=a(98076),x=a(71202);function h(e){let{budget:t,committed:a,plImpact:n,thisMonthPL:h,thisMonthChange:p,nextPLHits:g=[],plGap:f,monthlyBreakdown:b=[],loading:j=!1,onViewGapAnalysis:v}=e,[N,y]=(0,r.useState)(!0),w=t>0?a/t*100:0,_=t>0?n/t*100:0,k=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,notation:e>1e6?"compact":"standard"}).format(e);return((0,r.useEffect)(()=>{let e=setInterval(()=>{y(e=>!e)},2e3);return()=>clearInterval(e)},[]),j)?(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{className:"flex items-center justify-between",children:(0,s.jsx)("span",{className:"flex items-center gap-2",children:"P&L COMMAND CENTER"})})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})]}):(0,s.jsxs)(l.Zb,{className:"w-full border-2 border-blue-100 shadow-xl",children:[(0,s.jsx)(l.Ol,{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:(0,s.jsxs)(l.ll,{className:"flex items-center justify-between text-xl",children:[(0,s.jsxs)("span",{className:"flex items-center gap-3",children:[(0,s.jsx)(o.Z,{className:"h-6 w-6 text-blue-600"}),"P&L COMMAND CENTER"]}),(0,s.jsxs)(c.C,{variant:"outline",className:(0,x.cn)("flex items-center gap-1",N?"border-green-500 text-green-600":"border-gray-400"),children:[(0,s.jsx)(d.Z,{className:"h-3 w-3"}),"Live"]})]})}),(0,s.jsxs)(l.aY,{className:"p-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-600 mb-4",children:"FINANCIAL REALITY CHECK"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"APPROVED BUDGET"}),(0,s.jsx)("span",{className:"text-lg font-bold",children:k(t)})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-8 relative overflow-hidden",children:(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-blue-500 rounded-full",style:{width:"100%"}})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"TOTAL PO VALUE"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-lg font-bold",children:k(a)}),(0,s.jsxs)(c.C,{variant:"secondary",children:[w.toFixed(1),"%"]})]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-8 relative overflow-hidden",children:(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-400 to-indigo-500 rounded-full transition-all duration-700 ease-out",style:{width:"".concat(Math.min(w,100),"%")}})}),f>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-sm text-amber-600",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:["Open PO (Not Yet Invoiced): ",k(f)]})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"ACTUAL COST (Invoiced)"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-lg font-bold text-green-600",children:k(n)}),(0,s.jsxs)(c.C,{variant:"outline",className:"border-green-500 text-green-600",children:[_.toFixed(1),"%"]})]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-8 relative overflow-hidden",children:(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-green-400 to-green-500 rounded-full transition-all duration-700 ease-out",style:{width:"".concat(Math.min(_,100),"%")}})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-sm text-green-600",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Actual costs in books"})]})]})]}),b&&b.length>0&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 text-blue-600"}),"Monthly Cost Breakdown - When Costs Hit"]}),(0,s.jsx)("div",{className:"grid grid-cols-6 gap-2",children:b.slice(0,6).map((e,t)=>{let a=e.actual>0,r=e.projected>0;return e.actual,e.projected,(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-1",children:e.month}),(0,s.jsxs)("div",{className:"space-y-1",children:[a&&(0,s.jsx)("div",{className:"bg-green-500 rounded px-1 py-0.5",children:(0,s.jsx)("div",{className:"text-xs text-white font-medium",children:k(e.actual)})}),r&&(0,s.jsx)("div",{className:"bg-amber-400 rounded px-1 py-0.5 opacity-75",children:(0,s.jsxs)("div",{className:"text-xs text-white font-medium",children:["+",k(e.projected)]})}),!a&&!r&&(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"-"})]})]},t)})}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4 mt-3 text-xs",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Actual (Invoiced)"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-amber-400 rounded opacity-75"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Expected (Promise Dates)"})]})]})]}),f>0&&(0,s.jsx)("div",{className:"mt-6 p-4 bg-amber-50 rounded-lg border border-amber-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 text-amber-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold text-amber-900",children:"P&L Gap Analysis"}),(0,s.jsxs)("div",{className:"text-sm text-amber-700",children:[(f/a*100).toFixed(1),"% of committed spend hasn't hit P&L"]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-amber-900",children:k(f)}),(0,s.jsx)("div",{className:"text-xs text-amber-600",children:"Future P&L Impact"})]})]})})]})]})}var p=a(61997),g=a(56092),f=a(89340),b=a(45309),j=a(29976),v=a(10657),N=a(47894);function y(e){let{categories:t,onDrillDown:a,onCustomize:r,loading:n=!1}=e,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,notation:t?"compact":"standard"}).format(e)},c=e=>"".concat(e.toFixed(0),"%");if(n)return(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"FINANCIAL CONTROL MATRIX"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})]});let o=(()=>{let e=[],a=t.reduce((e,t)=>t.gapToPL>e.gapToPL?t:e,t[0]);a&&a.gapToPL>0&&e.push({type:"warning",text:"".concat(a.name," has largest P&L gap (").concat(i(a.gapToPL,!0)," uncommitted)")});let s=t.reduce((e,t)=>(t.committed>0?t.plImpact/t.committed*100:0)>(e.committed>0?e.plImpact/e.committed*100:0)?t:e,t[0]);if(s&&s.committed>0){let t=s.plImpact/s.committed*100;e.push({type:"success",text:"".concat(s.name," most efficient (").concat(t.toFixed(0),"% of commitments in P&L)")})}let r=t.reduce((e,t)=>t.gapToPL<e.gapToPL?t:e,t[0]);return r&&e.push({type:"info",text:"".concat(r.name," has smallest future P&L risk (").concat(i(r.gapToPL,!0),")")}),e})();return(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between",children:[(0,s.jsx)(l.ll,{className:"text-lg font-semibold",children:"FINANCIAL CONTROL MATRIX"}),r&&(0,s.jsxs)(p.z,{variant:"ghost",size:"sm",onClick:r,className:"flex items-center gap-1",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4"}),"Customize"]})]}),(0,s.jsxs)(l.aY,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-5 gap-4 pb-3 border-b text-sm font-medium text-gray-600",children:[(0,s.jsx)("div",{children:"Category"}),(0,s.jsx)("div",{className:"text-right",children:"Budget"}),(0,s.jsx)("div",{className:"text-right",children:"Total PO Value"}),(0,s.jsx)("div",{className:"text-right",children:"Actual Cost"}),(0,s.jsx)("div",{className:"text-right",children:"Open PO"})]}),(0,s.jsx)("div",{className:"space-y-4",children:t.map(e=>{let t=e.budget>0?e.committed/e.budget*100:0,r=e.budget>0?e.plImpact/e.budget*100:0,n=e.budget>0?e.gapToPL/e.budget*100:0;return(0,s.jsxs)("div",{className:"group hover:bg-gray-50 rounded-lg p-3 transition-colors cursor-pointer",onClick:()=>null==a?void 0:a(e.name),children:[(0,s.jsxs)("div",{className:"grid grid-cols-5 gap-4 items-center mb-3",children:[(0,s.jsxs)("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.name,(0,s.jsx)(b.Z,{className:"h-4 w-4 text-gray-400 group-hover:text-gray-600 transition-colors"})]}),(0,s.jsx)("div",{className:"text-right font-semibold",children:i(e.budget)}),(0,s.jsx)("div",{className:"text-right font-semibold",children:i(e.committed)}),(0,s.jsx)("div",{className:"text-right font-semibold text-green-600",children:i(e.plImpact)}),(0,s.jsx)("div",{className:"text-right font-semibold text-amber-600",children:i(e.gapToPL)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-5 gap-4 items-center",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"100%"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.E,{value:100,className:"h-2"}),(0,s.jsx)("span",{className:"absolute -top-5 right-0 text-xs text-gray-500",children:"100%"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.E,{value:Math.min(t,100),className:(0,x.cn)("h-2",t>100&&"[&>div]:bg-red-500")}),(0,s.jsx)("span",{className:"absolute -top-5 right-0 text-xs text-gray-500",children:c(t)})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.E,{value:Math.min(r,100),className:"h-2 [&>div]:bg-green-500"}),(0,s.jsx)("span",{className:"absolute -top-5 right-0 text-xs text-gray-500",children:c(r)})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.E,{value:Math.min(n,100),className:"h-2 [&>div]:bg-amber-500"}),(0,s.jsx)("span",{className:"absolute -top-5 right-0 text-xs text-gray-500",children:c(n)})]})]})]},e.name)})}),o.length>0&&(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 font-semibold text-blue-900 mb-2",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4"}),"Key Insights"]}),o.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-2 text-sm",children:["warning"===e.type&&(0,s.jsx)(v.Z,{className:"h-4 w-4 text-amber-600 mt-0.5"}),"success"===e.type&&(0,s.jsx)(N.Z,{className:"h-4 w-4 text-green-600 mt-0.5"}),"info"===e.type&&(0,s.jsx)(j.Z,{className:"h-4 w-4 text-blue-600 mt-0.5"}),(0,s.jsx)("span",{className:"text-gray-700",children:e.text})]},t)),a&&(0,s.jsx)(p.z,{variant:"outline",size:"sm",className:"w-full mt-3",onClick:()=>a("all"),children:"Drill Into Categories"})]})]})]})}var w=a(30579),_=a(97010),k=a(26825),O=a(36649),S=a(85482),C=a(44768),D=a(1027),T=a(12488),L=a(72008),E=a(25023),A=a(90106);function M(e){var t;let{data:a,events:r=[],currentMonth:n=new Date().getMonth(),view:o="monthly",onViewChange:d,onRefresh:u,loading:h=!1}=e,g=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,notation:e>1e6?"compact":"standard"}).format(e),f=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),b=Math.max(...a.map(e=>Math.max(e.actualPL+e.projectedPL,e.budget,e.cumulative)));return h?(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"P&L IMPACT TIMELINE"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})]}):(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 text-blue-600"}),"ACTUAL COST TIMELINE (When Costs Hit)"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex items-center bg-gray-100 rounded-md p-1",children:["monthly","quarterly","yearly"].map(e=>(0,s.jsx)(p.z,{variant:o===e?"default":"ghost",size:"sm",className:(0,x.cn)("px-3 py-1 text-xs",o===e?"bg-blue-600 text-white":"text-gray-600"),onClick:()=>null==d?void 0:d(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),u&&(0,s.jsx)(p.z,{variant:"ghost",size:"sm",onClick:u,className:"flex items-center gap-1",children:(0,s.jsx)(A.Z,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)(l.aY,{children:[(0,s.jsx)("div",{className:"h-[400px] mb-6",children:(0,s.jsx)(w.h,{width:"100%",height:"100%",children:(0,s.jsxs)(_.c,{data:a,margin:{top:20,right:30,left:20,bottom:20},children:[(0,s.jsx)("defs",{children:(0,s.jsx)("pattern",{id:"stripes",patternUnits:"userSpaceOnUse",width:"4",height:"4",children:(0,s.jsx)("path",{d:"M 0 4 L 4 0",stroke:"#fbbf24",strokeWidth:"1",opacity:"0.5"})})}),(0,s.jsx)(k.q,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,s.jsx)(O.K,{dataKey:"month",tick:{fontSize:12},stroke:"#6b7280"}),(0,s.jsx)(S.B,{tick:{fontSize:12},stroke:"#6b7280",tickFormatter:e=>"$".concat(e/1e3,"K"),domain:[0,1.1*b]}),(0,s.jsx)(C.u,{content:(0,s.jsx)(e=>{let{active:t,payload:a,label:r}=e;if(t&&a&&a.length){let e=a[0].payload;return(0,s.jsxs)("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900 mb-2",children:r}),e.actualPL>0&&(0,s.jsxs)("p",{className:"text-sm text-green-600",children:["Actual P&L: ",g(e.actualPL)]}),e.projectedPL>0&&(0,s.jsxs)("p",{className:"text-sm text-amber-600",children:["Projected P&L: ",g(e.projectedPL)]}),(0,s.jsxs)("p",{className:"text-sm text-blue-600",children:["Budget: ",g(e.budget)]}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mt-1 pt-1 border-t",children:["Cumulative: ",g(e.cumulative)]})]})}return null},{})}),(0,s.jsx)(D.D,{wrapperStyle:{paddingTop:"20px"},iconType:"rect"}),(0,s.jsx)(T.x,{type:"monotone",dataKey:"budget",stroke:"#3b82f6",strokeWidth:2,strokeDasharray:"5 5",name:"Budget Baseline",dot:!1}),(0,s.jsx)(L.$,{dataKey:"actualPL",fill:"#10b981",name:"Actual P&L Impact",radius:[4,4,0,0]}),(0,s.jsx)(L.$,{dataKey:"projectedPL",fill:"url(#stripes)",name:"Projected P&L Impact",radius:[4,4,0,0]}),(0,s.jsx)(T.x,{type:"monotone",dataKey:"cumulative",stroke:"#6366f1",strokeWidth:3,name:"Cumulative P&L",dot:{fill:"#6366f1",r:4}}),(0,s.jsx)(E.d,{x:null===(t=a[n])||void 0===t?void 0:t.month,stroke:"#ef4444",strokeWidth:2,label:{value:"TODAY",position:"top"}})]})})}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-6 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 bg-green-500 rounded"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Actual Cost (Invoiced)"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 bg-amber-400 rounded opacity-50",style:{background:"repeating-linear-gradient(45deg, #fbbf24, #fbbf24 2px, transparent 2px, transparent 4px)"}}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Future Cost (Based on Promise Dates)"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-1 bg-blue-500"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Monthly Budget"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded-full bg-indigo-500"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Cumulative Cost"})]})]}),r.length>0&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,s.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4"}),"Key Cost Events"]}),(0,s.jsx)("div",{className:"space-y-2",children:r.slice(0,5).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["overdue"===e.type&&(0,s.jsx)(i.Z,{className:"h-4 w-4 text-red-500"}),"invoice"===e.type&&(0,s.jsx)(c.C,{variant:"outline",className:"text-xs border-green-500 text-green-600",children:"INVOICED"}),"expected"===e.type&&(0,s.jsx)(c.C,{variant:"outline",className:"text-xs border-amber-500 text-amber-600",children:"EXPECTED"}),(0,s.jsxs)("span",{className:"text-gray-700",children:[f(e.date),": ",e.description]})]}),(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:g(e.amount)})]},t))})]})]})]})}var P=a(99729),I=a(96024);function z(e){let{promises:t,currentDate:a=new Date,onDateClick:n,loading:c=!1}=e,[d,u]=(0,r.useState)(a.getMonth()),[h,g]=(0,r.useState)(a.getFullYear()),f=t.reduce((e,t)=>{let a=t.date.split("T")[0];return e[a]||(e[a]=[]),e[a].push(t),e},{}),j=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,notation:e>1e5?"compact":"standard"}).format(e),v=e=>{"prev"===e?0===d?(u(11),g(h-1)):u(d-1):11===d?(u(0),g(h+1)):u(d+1)},N=((e,t)=>{let a=new Date(t,e,1),s=new Date(t,e+1,0).getDate(),r=a.getDay(),n=[];for(let e=0;e<r;e++)n.push(null);for(let e=1;e<=s;e++)n.push(e);return n})(d,h),y=Object.entries(f).reduce((e,t)=>{let[a,s]=t,r=new Date(a);return r.getMonth()===d&&r.getFullYear()===h?e+s.reduce((e,t)=>e+t.amount,0):e},0),w=y>0?(y/25e5*100).toFixed(1):"0";return c?(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"P&L FORECAST CALENDAR"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})]}):(0,s.jsxs)(l.Zb,{className:"w-full",children:[(0,s.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 text-blue-600"}),"P&L FORECAST CALENDAR"]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[["January","February","March","April","May","June","July","August","September","October","November","December"][d]," ",h]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.z,{variant:"ghost",size:"sm",onClick:()=>v("prev"),children:(0,s.jsx)(P.Z,{className:"h-4 w-4"})}),(0,s.jsx)(p.z,{variant:"ghost",size:"sm",onClick:()=>v("next"),children:(0,s.jsx)(b.Z,{className:"h-4 w-4"})})]})]})]}),(0,s.jsxs)(l.aY,{children:[(0,s.jsx)("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,s.jsx)("div",{className:"text-center text-xs font-semibold text-gray-600 py-2",children:e},e))}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-2",children:N.map((e,t)=>{if(null===e)return(0,s.jsx)("div",{className:"h-20"},"empty-".concat(t));let r="".concat(h,"-").concat(String(d+1).padStart(2,"0"),"-").concat(String(e).padStart(2,"0")),l=f[r]||[],c=l.reduce((e,t)=>e+t.amount,0),u=l.some(e=>e.isOverdue),m=l.some(e=>e.amount>1e5),p=e===a.getDate()&&d===a.getMonth()&&h===a.getFullYear();return(0,s.jsxs)("div",{className:(0,x.cn)("h-20 p-2 border rounded-lg cursor-pointer transition-all hover:shadow-md",p&&"border-blue-500 bg-blue-50",l.length>0&&"bg-amber-50 border-amber-200",u&&"bg-red-50 border-red-300",!l.length&&!p&&"border-gray-200"),onClick:()=>l.length>0&&(null==n?void 0:n(r,l)),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,s.jsx)("span",{className:(0,x.cn)("text-sm font-medium",p&&"text-blue-600",u&&"text-red-600"),children:e}),u&&(0,s.jsx)(i.Z,{className:"h-3 w-3 text-red-500"}),!u&&m&&(0,s.jsx)(o.Z,{className:"h-3 w-3 text-amber-500"})]}),l.length>0&&(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-gray-900",children:j(c)}),l.length>1&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[l.length," items"]})]})]},"day-".concat(e))})}),(0,s.jsx)("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Month Total"}),(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:j(y)})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Budget Impact"}),(0,s.jsxs)("div",{className:"text-xl font-bold text-blue-600",children:[w,"%"]})]})]})}),(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-4 text-xs",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(i.Z,{className:"h-3 w-3 text-red-500"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Overdue"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(o.Z,{className:"h-3 w-3 text-amber-500"}),(0,s.jsx)("span",{className:"text-gray-600",children:"High Value"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(I.Z,{className:"h-3 w-3 text-blue-500"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Major Supplier"})]})]}),(0,s.jsx)("div",{className:"mt-2 text-center text-xs text-gray-500",children:"Click any date for line item details"})]})]})}var F=a(19191),Z=a(62074);function B(e){let{data:t,loading:a=!1,onDrillDown:n}=e,[i,c]=(0,r.useState)(new Set),[o,d]=(0,r.useState)("tree"),u=Object.values(t.reduce((e,t)=>(e[t.category]||(e[t.category]={category:t.category,total:0,budget:0,subcategories:[]}),e[t.category].total+=t.value,e[t.category].budget+=t.budget,e[t.category].subcategories.push(t),e),{})),m=u.map(e=>({name:e.category,value:e.total,children:e.subcategories.map(t=>({name:t.subcategory,value:t.value,category:e.category}))})),h=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,notation:e>1e6?"compact":"standard"}).format(e),g=e=>{let t=new Set(i);t.has(e)?t.delete(e):t.add(e),c(t)},f=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];return a?(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Spend by Subcategory"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})})]}):(0,s.jsxs)(l.Zb,{children:[(0,s.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between",children:[(0,s.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(I.Z,{className:"h-5 w-5 text-blue-600"}),"Spend by Subcategory"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.z,{variant:"tree"===o?"default":"outline",size:"sm",onClick:()=>d("tree"),children:"Treemap"}),(0,s.jsx)(p.z,{variant:"list"===o?"default":"outline",size:"sm",onClick:()=>d("list"),children:"List"})]})]}),(0,s.jsxs)(l.aY,{children:["tree"===o?(0,s.jsx)("div",{className:"h-[400px]",children:(0,s.jsx)(w.h,{width:"100%",height:"100%",children:(0,s.jsx)(F.W,{data:m,dataKey:"value",aspectRatio:4/3,stroke:"#fff",content:(0,s.jsx)(e=>{let{x:t,y:a,width:r,height:l,name:i,value:c,category:o}=e;return(0,s.jsxs)("g",{children:[(0,s.jsx)("rect",{x:t,y:a,width:r,height:l,style:{fill:f[u.findIndex(e=>e.category===(o||i))%f.length],stroke:"#fff",strokeWidth:2,strokeOpacity:1,cursor:"pointer"},onClick:()=>null==n?void 0:n(o||i,i)}),r>60&&l>30&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("text",{x:t+r/2,y:a+l/2-10,textAnchor:"middle",fill:"#fff",fontSize:"12",fontWeight:"bold",children:i}),(0,s.jsx)("text",{x:t+r/2,y:a+l/2+10,textAnchor:"middle",fill:"#fff",fontSize:"10",children:h(c)})]})]})},{})})})}):(0,s.jsx)("div",{className:"space-y-2",children:u.map((e,t)=>{let a=i.has(e.category),r=e.budget>0?e.total/e.budget*100:0;return(0,s.jsxs)("div",{className:"border rounded-lg",children:[(0,s.jsxs)("div",{className:"p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50",onClick:()=>g(e.category),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,s.jsx)(Z.Z,{className:"h-4 w-4 text-gray-500"}):(0,s.jsx)(b.Z,{className:"h-4 w-4 text-gray-500"}),(0,s.jsx)("div",{className:"w-3 h-3 rounded",style:{backgroundColor:f[t%f.length]}}),(0,s.jsx)("span",{className:"font-medium",children:e.category})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:[h(e.total)," / ",h(e.budget)]}),(0,s.jsxs)("span",{className:(0,x.cn)("font-medium",r>100?"text-red-600":r>80?"text-amber-600":"text-green-600"),children:[r.toFixed(1),"%"]})]})]}),a&&(0,s.jsx)("div",{className:"px-3 pb-3",children:(0,s.jsx)("div",{className:"ml-6 space-y-1 pt-2 border-t",children:e.subcategories.map(t=>{let a=t.budget>0?t.value/t.budget*100:0;return(0,s.jsxs)("div",{className:"flex items-center justify-between py-1 px-2 hover:bg-gray-50 rounded cursor-pointer",onClick:a=>{a.stopPropagation(),null==n||n(e.category,t.subcategory)},children:[(0,s.jsx)("span",{className:"text-sm text-gray-700",children:t.subcategory}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:h(t.value)}),(0,s.jsxs)("span",{className:(0,x.cn)("font-medium text-xs",a>100?"text-red-600":a>80?"text-amber-600":"text-green-600"),children:[a.toFixed(0),"%"]})]})]},t.subcategory)})})})]},e.category)})}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,s.jsx)("span",{children:"Total across all subcategories:"}),(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:h(u.reduce((e,t)=>e+t.total,0))})]})})]})]})}let Y={light:"",dark:".dark"},R=r.createContext(null);function U(e){let{id:t,className:a,children:n,config:l,...i}=e,c=r.useId(),o="chart-".concat(t||c.replace(/:/g,""));return(0,s.jsx)(R.Provider,{value:{config:l},children:(0,s.jsxs)("div",{"data-slot":"chart","data-chart":o,className:(0,x.cn)("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",a),...i,children:[(0,s.jsx)(K,{id:o,config:l}),(0,s.jsx)(w.h,{children:n})]})})}let K=e=>{let{id:t,config:a}=e,r=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return r.length?(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(Y).map(e=>{let[a,s]=e;return"\n".concat(s," [data-chart=").concat(t,"] {\n").concat(r.map(e=>{var t;let[s,r]=e,n=(null===(t=r.theme)||void 0===t?void 0:t[a])||r.color;return n?"  --color-".concat(s,": ").concat(n,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},q=C.u;function V(e){let{active:t,payload:a,className:n,indicator:l="dot",hideLabel:i=!1,hideIndicator:c=!1,label:o,labelFormatter:d,labelClassName:u,formatter:m,color:h,nameKey:p,labelKey:g}=e,{config:f}=function(){let e=r.useContext(R);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}(),b=r.useMemo(()=>{var e;if(i||!(null==a?void 0:a.length))return null;let[t]=a,r="".concat(g||(null==t?void 0:t.dataKey)||(null==t?void 0:t.name)||"value"),n=J(f,t,r),l=g||"string"!=typeof o?null==n?void 0:n.label:(null===(e=f[o])||void 0===e?void 0:e.label)||o;return d?(0,s.jsx)("div",{className:(0,x.cn)("font-medium",u),children:d(l,a)}):l?(0,s.jsx)("div",{className:(0,x.cn)("font-medium",u),children:l}):null},[o,d,a,i,u,f,g]);if(!t||!(null==a?void 0:a.length))return null;let j=1===a.length&&"dot"!==l;return(0,s.jsxs)("div",{className:(0,x.cn)("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",n),children:[j?null:b,(0,s.jsx)("div",{className:"grid gap-1.5",children:a.map((e,t)=>{let a="".concat(p||e.name||e.dataKey||"value"),r=J(f,e,a),n=h||e.payload.fill||e.color;return(0,s.jsx)("div",{className:(0,x.cn)("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5","dot"===l&&"items-center"),children:m&&(null==e?void 0:e.value)!==void 0&&e.name?m(e.value,e.name,e,t,e.payload):(0,s.jsxs)(s.Fragment,{children:[(null==r?void 0:r.icon)?(0,s.jsx)(r.icon,{}):!c&&(0,s.jsx)("div",{className:(0,x.cn)("shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",{"h-2.5 w-2.5":"dot"===l,"w-1":"line"===l,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===l,"my-0.5":j&&"dashed"===l}),style:{"--color-bg":n,"--color-border":n}}),(0,s.jsxs)("div",{className:(0,x.cn)("flex flex-1 justify-between leading-none",j?"items-end":"items-center"),children:[(0,s.jsxs)("div",{className:"grid gap-1.5",children:[j?b:null,(0,s.jsx)("span",{className:"text-muted-foreground",children:(null==r?void 0:r.label)||e.name})]}),e.value&&(0,s.jsx)("span",{className:"text-foreground font-mono font-medium tabular-nums",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})}function J(e,t,a){if("object"!=typeof t||null===t)return;let s="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,r=a;return a in t&&"string"==typeof t[a]?r=t[a]:s&&a in s&&"string"==typeof s[a]&&(r=s[a]),r in e?e[r]:e[a]}D.D;var W=a(98893);let X={budget:{label:"Budget",color:"#0014dc"},actual:{label:"Actual Spend",color:"#00d2dc"},forecast:{label:"Forecast",color:"#0099a3"}};function G(e){let{data:t}=e;return(0,s.jsx)(U,{config:X,className:"min-h-[300px] w-full",children:(0,s.jsxs)(_.c,{data:t,margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(k.q,{strokeDasharray:"3 3",className:"stroke-muted"}),(0,s.jsx)(O.K,{dataKey:"month",className:"text-xs",tick:{fill:"currentColor",fontSize:12},tickLine:{stroke:"currentColor"}}),(0,s.jsx)(S.B,{className:"text-xs",tick:{fill:"currentColor",fontSize:12},tickLine:{stroke:"currentColor"},tickFormatter:e=>"$".concat((e/1e3).toFixed(0),"K")}),(0,s.jsx)(q,{content:(0,s.jsx)(V,{className:"w-[180px]",nameKey:"month",formatter:e=>"$".concat((Number(e)/1e3).toFixed(1),"K")})}),(0,s.jsx)(D.D,{wrapperStyle:{paddingTop:"20px"},iconType:"line"}),(0,s.jsx)(W.u,{type:"monotone",dataKey:"budget",fill:"var(--color-budget)",fillOpacity:.2,stroke:"var(--color-budget)",strokeWidth:2}),(0,s.jsx)(T.x,{type:"monotone",dataKey:"actual",stroke:"var(--color-actual)",strokeWidth:2,dot:{r:3,fill:"var(--color-actual)"},activeDot:{r:5}}),(0,s.jsx)(L.$,{dataKey:"forecast",fill:"var(--color-forecast)",fillOpacity:.6})]})})}var $=a(13349),H=a(88116),Q=a(35599);let ee=["#0014dc","#00d2dc","#0099a3","#6366f1","#8b5cf6","#ec4899","#f59e0b","#10b981"];function et(e){let{data:t}=e,a=t.reduce((e,t,a)=>(e[t.name]={label:t.name,color:ee[a%ee.length]},e),{}),r=Math.PI/180;return(0,s.jsx)(U,{config:a,className:"min-h-[300px] w-full",children:(0,s.jsxs)($.u,{children:[(0,s.jsx)(H.b,{data:t,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{cx:t,cy:a,midAngle:n,innerRadius:l,outerRadius:i,percent:c}=e,o=l+(i-l)*.5,d=t+o*Math.cos(-n*r);return c<.05?null:(0,s.jsx)("text",{x:d,y:a+o*Math.sin(-n*r),fill:"white",textAnchor:d>t?"start":"end",dominantBaseline:"central",className:"text-xs font-medium",children:"".concat((100*c).toFixed(0),"%")})},outerRadius:100,fill:"#8884d8",dataKey:"value",children:t.map((e,t)=>(0,s.jsx)(Q.b,{fill:ee[t%ee.length]},"cell-".concat(t)))}),(0,s.jsx)(C.u,{content:(0,s.jsx)(e=>{let{active:t,payload:a}=e;if(t&&a&&a.length){let e=a[0];return(0,s.jsx)("div",{className:"rounded-lg border bg-background p-2 shadow-sm",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:[e.name,":"]}),(0,s.jsxs)("span",{className:"text-sm font-bold",children:["$",(e.value/1e3).toFixed(1),"K"]})]}),e.payload.budget&&(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Budget:"}),(0,s.jsxs)("span",{className:"text-xs",children:["$",(e.payload.budget/1e3).toFixed(1),"K"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Utilization:"}),(0,s.jsx)("span",{className:"text-xs",children:e.payload.budget>0?"".concat((e.value/e.payload.budget*100).toFixed(1),"%"):"N/A"})]})]})})}return null},{})}),(0,s.jsx)(D.D,{verticalAlign:"bottom",height:36,iconType:"square",formatter:e=>(0,s.jsx)("span",{className:"text-xs",children:e})})]})})}var ea=a(75997),es=a(23482);function er(e){let{data:t}=e,[a,n]=(0,r.useState)(new Set),l=e=>{let t=new Set(a);t.has(e)?t.delete(e):t.add(e),n(t)},i=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0,notation:Math.abs(e)>999999?"compact":"standard"}).format(e),o=e=>e>100?"text-red-600 font-bold":e>90?"text-orange-600 font-semibold":e>75?"text-yellow-600":"text-gray-600",d=e=>e>100?"bg-red-500":e>90?"bg-orange-500":e>75?"bg-yellow-500":"bg-blue-500",u=e=>{switch(e){case"business_line":return"default";case"cost_line":return"secondary";default:return"outline"}},m=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=a.has(e.id),h=e.children&&e.children.length>0;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(es.SC,{className:(0,x.cn)("hover:bg-muted/50 transition-colors",0===r&&"font-semibold",1===r&&"font-medium"),children:[(0,s.jsx)(es.pj,{style:{paddingLeft:"".concat(24*r+16,"px")},children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[h&&(0,s.jsx)(p.z,{variant:"ghost",size:"sm",className:"p-0 h-5 w-5",onClick:()=>l(e.id),children:n?(0,s.jsx)(Z.Z,{className:"h-4 w-4"}):(0,s.jsx)(b.Z,{className:"h-4 w-4"})}),!h&&r>0&&(0,s.jsx)("div",{className:"w-5"}),(0,s.jsx)("span",{className:(0,x.cn)(0===r&&"font-semibold"),children:e.name}),(0,s.jsx)(c.C,{variant:u(e.level),className:"text-xs ml-2",children:e.level.replace("_"," ")})]})}),(0,s.jsx)(es.pj,{className:"text-right",children:i(e.budget)}),(0,s.jsx)(es.pj,{className:"text-right",children:i(e.actual)}),(0,s.jsx)(es.pj,{className:"text-right",children:(0,s.jsxs)("span",{className:(0,x.cn)(e.variance>=0?"text-green-600":"text-red-600",Math.abs(e.variance)>.2*e.budget&&"font-semibold"),children:[i(Math.abs(e.variance)),e.variance<0&&" over"]})}),(0,s.jsx)(es.pj,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:(0,x.cn)("h-full transition-all",d(e.utilization)),style:{width:"".concat(Math.min(e.utilization,100),"%")}})}),(0,s.jsxs)("span",{className:(0,x.cn)("text-xs w-12 text-right",o(e.utilization)),children:[e.utilization.toFixed(0),"%"]})]})}),(0,s.jsx)(es.pj,{children:"sub_category"===e.level&&(0,s.jsxs)(p.z,{variant:"outline",size:"sm",className:"h-7",children:[(0,s.jsx)(ea.Z,{className:"h-3 w-3 mr-1"}),"Details"]})})]},e.id),n&&h&&(null===(t=e.children)||void 0===t?void 0:t.map(e=>m(e,r+1)))]})};return t&&0!==t.length?(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(es.iA,{children:[(0,s.jsx)(es.xD,{children:(0,s.jsxs)(es.SC,{children:[(0,s.jsx)(es.ss,{className:"w-[40%]",children:"Category"}),(0,s.jsx)(es.ss,{className:"text-right",children:"Budget"}),(0,s.jsx)(es.ss,{className:"text-right",children:"Actual"}),(0,s.jsx)(es.ss,{className:"text-right",children:"Variance"}),(0,s.jsx)(es.ss,{className:"w-[20%]",children:"Utilization"}),(0,s.jsx)(es.ss,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(es.RM,{children:t.map(e=>m(e))})]})}):(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No cost breakdown data available"})}var en=a(16832);function el(){return(0,s.jsxs)("div",{className:"container mx-auto p-6 max-w-[1600px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(en.O,{className:"h-9 w-64 mb-2"}),(0,s.jsx)(en.O,{className:"h-5 w-32"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(en.O,{className:"h-9 w-24"}),(0,s.jsx)(en.O,{className:"h-9 w-24"}),(0,s.jsx)(en.O,{className:"h-9 w-24"}),(0,s.jsx)(en.O,{className:"h-9 w-32"})]})]}),(0,s.jsx)(l.Zb,{className:"p-4 mb-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,s.jsx)(en.O,{className:"h-10 w-full lg:col-span-2"}),(0,s.jsx)(en.O,{className:"h-10 w-full"}),(0,s.jsx)(en.O,{className:"h-10 w-full"}),(0,s.jsx)(en.O,{className:"h-10 w-full"})]})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)(l.Zb,{className:"border-l-4 border-l-gray-300",children:[(0,s.jsx)(l.Ol,{className:"pb-2",children:(0,s.jsx)(en.O,{className:"h-4 w-24"})}),(0,s.jsxs)(l.aY,{children:[(0,s.jsx)(en.O,{className:"h-8 w-32"}),(0,s.jsx)(en.O,{className:"h-3 w-16 mt-2"})]})]},t))}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(en.O,{className:"h-5 w-48"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)(en.O,{className:"h-[300px] w-full"})})]}),(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(en.O,{className:"h-5 w-40"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)(en.O,{className:"h-[300px] w-full"})})]})]}),(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(en.O,{className:"h-5 w-36"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)(en.O,{className:"h-[300px] w-full"})})]}),(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(en.O,{className:"h-5 w-48"})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 pb-2 border-b",children:[(0,s.jsx)(en.O,{className:"h-4 w-32"}),(0,s.jsx)(en.O,{className:"h-4 w-24 ml-auto"}),(0,s.jsx)(en.O,{className:"h-4 w-24"}),(0,s.jsx)(en.O,{className:"h-4 w-24"}),(0,s.jsx)(en.O,{className:"h-4 w-32"}),(0,s.jsx)(en.O,{className:"h-4 w-24"})]}),Array.from({length:5}).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-4 py-3",children:[(0,s.jsx)(en.O,{className:"h-4 w-40"}),(0,s.jsx)(en.O,{className:"h-4 w-20 ml-auto"}),(0,s.jsx)(en.O,{className:"h-4 w-20"}),(0,s.jsx)(en.O,{className:"h-4 w-20"}),(0,s.jsx)(en.O,{className:"h-8 w-32"}),(0,s.jsx)(en.O,{className:"h-8 w-20"})]},t))]})})]})]})]})}function ei(e){let t=e.filter(e=>"string"==typeof e&&e.trim().length>0);if(0===t.length)return null;let a=t.map(e=>{let t=e.replace(/"/g,'""');return'"'.concat(t,'"')});return"(".concat(a.join(","),")")}let ec=e=>{let t=Number(e);return Number.isFinite(t)?t:0},eo=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);function ed(e){var t,a,s,r,n,l,i,c,o,d,u,m,x;if(!e||!e.id)throw Error("Unable to normalize PO line item without an id");let h=ec(null!==(s=null!==(a=null!==(t=e.line_value)&&void 0!==t?t:e.value)&&void 0!==a?a:e.total_value)&&void 0!==s?s:0),p=ec(null!==(c=null!==(i=null!==(l=null!==(n=null!==(r=e.invoiced_value_usd)&&void 0!==r?r:e.invoiced_value)&&void 0!==n?n:e.invoice_value_usd)&&void 0!==l?l:e.invoice_value)&&void 0!==i?i:e.actual_value)&&void 0!==c?c:0),g=eo(e,"invoiced_value_usd")||eo(e,"invoiced_value")||eo(e,"invoice_value_usd")||eo(e,"invoice_value"),f=eo(e,"supplier_promise_date")||eo(e,"promise_date");return{id:e.id,lineValue:h,invoiceValue:p,invoiceDate:null!==(o=e.invoice_date)&&void 0!==o?o:null,promiseDate:null!==(u=null!==(d=e.supplier_promise_date)&&void 0!==d?d:e.promise_date)&&void 0!==u?u:null,createdAt:null!==(x=null!==(m=e.created_at)&&void 0!==m?m:e.updated_at)&&void 0!==x?x:null,hasInvoiceField:g,hasPromiseField:f}}function eu(e,t){let a=t.lineValue>0?t.lineValue:e;if(t.hasInvoiceField){let s=t.invoiceValue*(a>0?Math.min(e/a,1):1);return{actual:s,future:Math.max(e-s,0)}}let s=.6*e;return{actual:s,future:Math.max(e-s,0)}}function em(e){var t;return null!==(t=e.promiseDate)&&void 0!==t?t:null}async function ex(e,t){let a=(0,n.e)(),s=a.from("cost_breakdown").select("id, budget_cost, cost_line, spend_type").eq("project_id",e);(null==t?void 0:t.costLine)&&"all"!==t.costLine&&(s=s.eq("cost_line",t.costLine)),(null==t?void 0:t.spendType)&&"all"!==t.spendType&&(s=s.eq("spend_type",t.spendType));let{data:r,error:l}=await s;if(l)throw console.error("Error fetching budget data:",l),l;let i=(null==r?void 0:r.reduce((e,t)=>e+(Number(t.budget_cost)||0),0))||0,c=ei((null==r?void 0:r.map(e=>e.id))||[]),o=[];if(c){let{data:e,error:t}=await a.from("po_mappings").select("\n        id,\n        mapped_amount,\n        cost_breakdown_id,\n        po_line_item_id\n      ").filter("cost_breakdown_id","in",c);t?console.error("Error fetching PO mappings:",t):e&&(o=e)}let d=0,u=0,m=0,x=0,h=0;if(d=o.reduce((e,t)=>e+(Number(t.mapped_amount)||0),0),o.length>0){let e=ei(o.map(e=>e.po_line_item_id));if(e){let{data:t,error:s}=await a.from("po_line_items").select("*").filter("id","in",e);if(!s&&t){let e=new Map;t.forEach(t=>{try{let a=ed(t);e.set(a.id,a)}catch(e){console.warn("Skipping malformed PO line item record in metrics",e)}}),o.forEach(t=>{let a=Number(t.mapped_amount)||0,s=t.po_line_item_id?e.get(t.po_line_item_id):void 0;if(!s){let e=.6*a;u+=e,m+=Math.max(a-e,0);return}let{actual:r,future:n}=eu(a,s);u+=r,m+=n}),x=new Set(t.map(e=>e.po_id)).size,h=t.length}}}let p=i-d,g=i>0?d/i*100:0,f=new Date(2024,0,1),b=d/Math.max(1,Math.floor((Date.now()-f.getTime())/2592e6));return{totalBudget:i,actualSpend:d,variance:p,variancePercent:i>0?p/i*100:0,utilization:g,invoicedAmount:u,openOrders:m,burnRate:b,poCount:x,lineItemCount:h}}async function eh(e,t){let a=(0,n.e)().from("cost_breakdown").select("budget_cost").eq("project_id",e);(null==t?void 0:t.costLine)&&"all"!==t.costLine&&(a=a.eq("cost_line",t.costLine)),(null==t?void 0:t.spendType)&&"all"!==t.spendType&&(a=a.eq("spend_type",t.spendType));let{data:s}=await a,r=(null==s?void 0:s.reduce((e,t)=>e+(Number(t.budget_cost)||0),0))||0,l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=new Date().getMonth(),c=[],o=0;if(r>0){let e=r/12;for(let t=0;t<=i;t++){let a=e*(.6+.3*Math.random()),s=.9*e;o+=a,c.push({month:l[t],budget:Math.round((t+1)*e),actual:Math.round(o),forecast:Math.round((t+1)*s)})}}else for(let e=0;e<=i;e++)c.push({month:l[e],budget:(e+1)*5e4,actual:(e+1)*35e3,forecast:(e+1)*45e3});return console.log("getTimelineData - Returning",c.length,"months of data"),c}async function ep(e,t){let a=(0,n.e)(),s=a.from("cost_breakdown").select("spend_type, budget_cost, id").eq("project_id",e);(null==t?void 0:t.costLine)&&"all"!==t.costLine&&(s=s.eq("cost_line",t.costLine));let{data:r,error:l}=await s;if(l)return console.error("Error fetching category data:",l),[];console.log("getCategoryBreakdown - Cost data fetched:",(null==r?void 0:r.length)||0,"items");let i=ei((null==r?void 0:r.map(e=>e.id))||[]),c=[];if(i){let{data:e}=await a.from("po_mappings").select("cost_breakdown_id, mapped_amount").filter("cost_breakdown_id","in",i);c=e||[]}console.log("getCategoryBreakdown - Mappings fetched:",c.length,"items");let o={};return null==r||r.forEach(e=>{o[e.spend_type]||(o[e.spend_type]={name:e.spend_type,value:0,budget:0}),o[e.spend_type].budget+=Number(e.budget_cost)||0}),c.length>0?c.forEach(e=>{let t=null==r?void 0:r.find(t=>t.id===e.cost_breakdown_id);t&&o[t.spend_type]&&(o[t.spend_type].value+=Number(e.mapped_amount)||0)}):Object.keys(o).forEach(e=>{o[e].value=.65*o[e].budget}),Object.values(o)}async function eg(e,t){let a=(0,n.e)(),s=a.from("cost_breakdown").select("*").eq("project_id",e).order("sub_business_line, cost_line, spend_type, spend_sub_category");(null==t?void 0:t.costLine)&&"all"!==t.costLine&&(s=s.eq("cost_line",t.costLine)),(null==t?void 0:t.spendType)&&"all"!==t.spendType&&(s=s.eq("spend_type",t.spendType));let{data:r,error:l}=await s;if(l)return console.error("Error fetching breakdown data:",l),[];console.log("Cost breakdown data fetched:",(null==r?void 0:r.length)||0,"items");let i=ei((null==r?void 0:r.map(e=>e.id))||[]),c=[];if(i){let{data:e}=await a.from("po_mappings").select("cost_breakdown_id, mapped_amount").filter("cost_breakdown_id","in",i);c=e||[]}console.log("getHierarchicalBreakdown - Mappings fetched:",c.length,"items");let o={};c.length>0?c.forEach(e=>{o[e.cost_breakdown_id]=(o[e.cost_breakdown_id]||0)+(Number(e.mapped_amount)||0)}):null==r||r.forEach(e=>{o[e.id]=.65*(Number(e.budget_cost)||0)});let d={};null==r||r.forEach(e=>{let{sub_business_line:t,cost_line:a,spend_type:s,spend_sub_category:r}=e,n=Number(e.budget_cost)||0,l=o[e.id]||0;d[t]||(d[t]={id:"bl_".concat(t),level:"business_line",name:t,budget:0,actual:0,variance:0,utilization:0,children:{}}),d[t].children[a]||(d[t].children[a]={id:"cl_".concat(t,"_").concat(a),level:"cost_line",name:a,budget:0,actual:0,variance:0,utilization:0,children:{}}),d[t].children[a].children[s]||(d[t].children[a].children[s]={id:"st_".concat(t,"_").concat(a,"_").concat(s),level:"spend_type",name:s,budget:0,actual:0,variance:0,utilization:0,children:[]});let i={id:e.id,level:"sub_category",name:r,budget:n,actual:l,variance:n-l,utilization:n>0?l/n*100:0};d[t].children[a].children[s].children.push(i),d[t].children[a].children[s].budget+=n,d[t].children[a].children[s].actual+=l,d[t].children[a].budget+=n,d[t].children[a].actual+=l,d[t].budget+=n,d[t].actual+=l});let u=[];return Object.values(d).forEach(e=>{e.variance=e.budget-e.actual,e.utilization=e.budget>0?e.actual/e.budget*100:0;let t=[];Object.values(e.children).forEach(e=>{e.variance=e.budget-e.actual,e.utilization=e.budget>0?e.actual/e.budget*100:0;let a=[];Object.values(e.children).forEach(e=>{e.variance=e.budget-e.actual,e.utilization=e.budget>0?e.actual/e.budget*100:0,a.push({...e,children:e.children})}),t.push({...e,children:a})}),u.push({...e,children:t})}),u}async function ef(e,t){let a=(0,n.e)(),s=a.from("cost_breakdown").select("id, budget_cost").eq("project_id",e);(null==t?void 0:t.costLine)&&(s=s.eq("cost_line",t.costLine)),(null==t?void 0:t.spendType)&&(s=s.eq("spend_type",t.spendType));let{data:r,error:l}=await s;if(l)throw l;let i=(null==r?void 0:r.reduce((e,t)=>e+(Number(t.budget_cost)||0),0))||0,c=ei((null==r?void 0:r.map(e=>e.id))||[]);if(!c)return{totalBudget:i,totalCommitted:0,actualPLImpact:0,futurePLImpact:0,plGap:0};let{data:o,error:d}=await a.from("po_mappings").select("mapped_amount, po_line_item_id").filter("cost_breakdown_id","in",c);if(d)throw d;let u=0,m=0,x=0,h=ei((o||[]).map(e=>e.po_line_item_id)),p=new Map;if(h){let{data:e,error:t}=await a.from("po_line_items").select("*").filter("id","in",h);if(t)throw t;null==e||e.forEach(e=>{try{let t=ed(e);p.set(t.id,t)}catch(e){console.warn("Skipping malformed PO line item record",e)}})}return o&&o.forEach(e=>{let t=Number(e.mapped_amount)||0;u+=t;let a=e.po_line_item_id?p.get(e.po_line_item_id):void 0;if(!a){let e=.6*t;m+=e,x+=Math.max(t-e,0);return}let{actual:s,future:r}=eu(t,a);m+=s,x+=r}),{totalBudget:i,totalCommitted:u,actualPLImpact:m,futurePLImpact:x,plGap:u-m}}async function eb(e,t,a){let s=(0,n.e)(),{data:r,error:l}=await s.from("cost_breakdown").select("id").eq("project_id",e);if(l)throw l;let i=ei((null==r?void 0:r.map(e=>e.id))||[]);if(!i)return[];let{data:c,error:o}=await s.from("po_mappings").select("mapped_amount, po_line_item_id").filter("cost_breakdown_id","in",i);if(o)throw o;let d=ei((c||[]).map(e=>e.po_line_item_id));if(!d)return[];let{data:u,error:m}=await s.from("po_line_items").select("*").filter("id","in",d);if(m)throw m;let x=new Map,h=!1;null==u||u.forEach(e=>{try{let t=ed(e);x.set(t.id,t),h=h||t.hasInvoiceField}catch(e){console.warn("Skipping malformed PO line item record",e)}});let p=new Map,g=e=>{if(!e)return null;let s=new Date(e);return Number.isNaN(s.getTime())||s<t||s>a?null:s},f=(e,t,a)=>{if(!e||a<=0)return;let s="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0")),r=p.get(s)||{actual:0,projected:0};r[t]+=a,p.set(s,r)};(c||[]).forEach(e=>{var s,r,n;let l=Number(e.mapped_amount)||0,i=e.po_line_item_id?x.get(e.po_line_item_id):void 0;if(!i){let e=h?0:.6*l,s=Math.max(l-e,0);f(new Date(t),"actual",e),s>0&&f(new Date(a),"projected",s);return}let{actual:c,future:o}=eu(l,i),d=g(null!==(n=null!==(r=i.invoiceDate)&&void 0!==r?r:i.createdAt)&&void 0!==n?n:null),u=g(em(i)),m=null!=d?d:g(i.createdAt),p=null!==(s=null!=u?u:m)&&void 0!==s?s:new Date(a);f(m,"actual",c),o>0&&f(p,"projected",o)});let b=[],j=0;return Array.from(p.keys()).sort().forEach(e=>{let[t,a]=e.split("-"),s=p.get(e);j+=s.actual+s.projected,b.push({month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(a)-1]||"",year:parseInt(t),actualPL:s.actual,projectedPL:s.projected,cumulative:j})}),b}async function ej(e){let t=(0,n.e)(),{data:a,error:s}=await t.from("cost_breakdown").select("id").eq("project_id",e);if(s)throw s;let r=ei((null==a?void 0:a.map(e=>e.id))||[]);if(!r)return new Map;let{data:l,error:i}=await t.from("po_mappings").select("mapped_amount, po_line_item_id").filter("cost_breakdown_id","in",r);if(i)throw i;let c=ei((l||[]).map(e=>e.po_line_item_id));if(!c)return new Map;let{data:o,error:d}=await t.from("po_line_items").select("*").filter("id","in",c);if(d)throw d;let u=new Map;null==o||o.forEach(e=>{try{let t=ed(e);u.set(t.id,t)}catch(e){console.warn("Skipping malformed PO line item record",e)}});let m=new Map;return l&&l.forEach(e=>{let t=Number(e.mapped_amount)||0,a=e.po_line_item_id?u.get(e.po_line_item_id):void 0;if(!a)return;let{future:s}=eu(t,a);if(s<=0)return;let r=em(a);if(!r)return;let n=new Date(r).toISOString().split("T")[0],l=m.get(n)||0;m.set(n,l+s)}),m}var ev=a(40814),eN=a(90033);async function ey(e,t){try{let a=e.innerHTML,s=window.open("","_blank");s&&(s.document.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(t," Dashboard</title>\n            <style>\n              body { font-family: sans-serif; padding: 20px; }\n              @media print {\n                body { margin: 0; }\n              }\n            </style>\n          </head>\n          <body>\n            <h1>").concat(t," Dashboard Report</h1>\n            <p>Generated: ").concat(new Date().toLocaleString(),"</p>\n            <hr>\n            ").concat(a,"\n          </body>\n        </html>\n      ")),s.document.close(),s.print())}catch(e){throw console.error("Error exporting PDF:",e),e}}async function ew(e,t){try{let a=function(e){let t=[];return t.push("METRICS"),t.push("Metric,Value"),e.metrics&&(t.push("Total Budget,".concat(e.metrics.totalBudget)),t.push("Actual Spend,".concat(e.metrics.actualSpend)),t.push("Variance,".concat(e.metrics.variance)),t.push("Utilization %,".concat(e.metrics.utilization)),t.push("Invoiced Amount,".concat(e.metrics.invoicedAmount)),t.push("Open Orders,".concat(e.metrics.openOrders)),t.push("PO Count,".concat(e.metrics.poCount))),t.push(""),t.push("TIMELINE DATA"),t.push("Month,Budget,Actual,Forecast"),e.timeline&&e.timeline.forEach(e=>{t.push("".concat(e.month,",").concat(e.budget,",").concat(e.actual,",").concat(e.forecast))}),t.push(""),t.push("CATEGORY BREAKDOWN"),t.push("Category,Budget,Actual Spend"),e.categories&&e.categories.forEach(e=>{t.push("".concat(e.name,",").concat(e.budget,",").concat(e.value))}),t.join("\n")}(e),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),n=URL.createObjectURL(s);r.setAttribute("href",n),r.setAttribute("download","".concat(t,"_dashboard_").concat(new Date().toISOString().split("T")[0],".csv")),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(e){throw console.error("Error exporting Excel:",e),e}}function e_(e){let{params:t}=e,a=t.id,c=(0,n.e)(),{toast:o}=(0,ev.pm)(),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(!0),[g,f]=(0,r.useState)(null),[b,j]=(0,r.useState)([]),[v,N]=(0,r.useState)([]),[w,_]=(0,r.useState)([]),[k,O]=(0,r.useState)([]),[S,C]=(0,r.useState)(!1),[D,T]=(0,r.useState)(null),[L,E]=(0,r.useState)([]),[P,I]=(0,r.useState)([]),[F,Z]=(0,r.useState)([]),[Y,R]=(0,r.useState)([]),[U,K]=(0,r.useState)({dateRange:{from:new Date(new Date().setMonth(new Date().getMonth()-6)),to:new Date},showForecasts:!0,comparisonMode:"none"});(0,r.useEffect)(()=>{q();let e=V();return()=>{null==e||e.unsubscribe()}},[a,U]);let q=async()=>{try{x(!0);let{data:e,error:t}=await c.from("projects").select("*").eq("id",a).single();if(t)throw t;f(e);let s=await ex(a,U);u(s);let r=await ef(a,{costLine:U.costLine,spendType:U.spendType});T(r),console.log("P&L Metrics:",r);let[n,l,i,o,d]=await Promise.all([eh(a,U),ep(a,U),eg(a,U),eb(a,U.dateRange.from,U.dateRange.to),ej(a)]);console.log("P&L Timeline:",o),console.log("Open POs by Promise Date:",d),console.log("Timeline data:",n),console.log("Category data:",l),console.log("Breakdown data:",i),j(n),N(l),_(i),E(o);let m=Array.from(d.entries()).map(e=>{let[t,a]=e;return{date:t,amount:a,supplier:"Multiple",lineItems:1}});I(m);let h=l.map(e=>({name:e.name,budget:e.budget,committed:e.value,plImpact:.6*e.value,gapToPL:.4*e.value}));Z(h);let p=[];console.log("Processing breakdown for subcategories, breakdown length:",i.length),i.forEach(e=>{console.log("Business Line:",e.name,"has children:",!!e.children),e.children&&e.children.forEach(e=>{console.log("  Cost Line:",e.name,"has children:",!!e.children),e.children&&e.children.forEach(e=>{console.log("    Spend Type:",e.name,"has children:",!!e.children),e.children&&e.children.forEach(t=>{console.log("      Subcategory:",t.name,"actual:",t.actual),p.push({category:e.name,subcategory:t.name,value:t.actual,budget:t.budget,percentage:t.utilization})})})})}),console.log("Total subcategories found:",p.length),R(p);let g=J(n);O(g)}catch(e){console.error("Error loading dashboard data:",e),o({variant:"destructive",title:"Failed to Load Dashboard",description:"Unable to load dashboard data. Please refresh the page."})}finally{x(!1)}},V=()=>c.channel("project-".concat(a)).on("postgres_changes",{event:"*",schema:"public",table:"po_mappings",filter:"project_id=eq.".concat(a)},e=>{console.log("PO mapping changed:",e),W()}).on("postgres_changes",{event:"*",schema:"public",table:"cost_breakdown",filter:"project_id=eq.".concat(a)},e=>{console.log("Cost breakdown changed:",e),W()}).subscribe(),J=e=>e.map((t,a)=>{let s=a>0?e[a-1].actual:0,r=t.actual-s;return{month:t.month,amount:r,cumulative:t.actual}}),W=async()=>{C(!0),await q(),C(!1)},X=async()=>{let e=document.getElementById("dashboard-content");e&&g&&(await ey(e,g.name),o({title:"Export Successful",description:"Dashboard exported to PDF"}))},$=async()=>{g&&d&&(await ew({metrics:d,breakdown:w,timeline:b,categories:v},g.name),o({title:"Export Successful",description:"Dashboard exported to Excel"}))};return m?(0,s.jsx)(el,{}):g?(0,s.jsxs)("div",{className:"container mx-auto p-6 max-w-[1600px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold",children:[g.name," Dashboard"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:g.sub_business_line})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(p.z,{variant:"outline",size:"sm",onClick:W,disabled:S,children:[(0,s.jsx)(A.Z,{className:"h-4 w-4 mr-1 ".concat(S?"animate-spin":"")}),"Refresh"]}),(0,s.jsx)(p.z,{variant:"outline",size:"sm",onClick:X,children:"Export PDF"}),(0,s.jsx)(p.z,{variant:"outline",size:"sm",onClick:$,children:"Export Excel"}),(0,s.jsx)(p.z,{variant:"outline",size:"sm",onClick:()=>window.history.back(),children:"Back to Projects"})]})]}),(0,s.jsxs)("div",{id:"dashboard-content",className:"space-y-6 mt-6",children:[!1,d&&(0,s.jsx)(h,{budget:d.totalBudget,committed:d.actualSpend,plImpact:d.invoicedAmount,thisMonthPL:d.invoicedAmount/12,thisMonthChange:23,nextPLHits:P.slice(0,3).map(e=>({date:e.date,amount:e.amount,supplier:e.supplier||"Various"})),plGap:d.actualSpend-d.invoicedAmount,monthlyBreakdown:L.map(e=>({month:e.month,actual:e.actualPL||0,projected:e.projectedPL||0})),loading:m,onViewGapAnalysis:()=>{console.log("View gap analysis")}}),F.length>0&&(0,s.jsx)(y,{categories:F,onDrillDown:e=>{console.log("Drill down into:",e)},onCustomize:()=>{console.log("Customize matrix view")},loading:m}),L.length>0&&(0,s.jsx)(M,{data:L.map(e=>({month:e.month,actualPL:e.actualPL,projectedPL:e.projectedPL,budget:(null==d?void 0:d.totalBudget)?d.totalBudget/12:0,cumulative:e.cumulative})),events:P.slice(0,5).map(e=>({date:e.date,amount:e.amount,description:"".concat(e.supplier," delivery"),type:new Date(e.date)<new Date?"overdue":"expected"})),currentMonth:new Date().getMonth(),view:"monthly",onViewChange:e=>console.log("Change view to:",e),onRefresh:W,loading:m}),b.length>0&&(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Budget vs Actual Timeline"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)(G,{data:b})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Spend by Category"})}),(0,s.jsx)(l.aY,{children:v.length>0?(0,s.jsx)(et,{data:v}):(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No category data available"})})]}),(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Spend by Subcategory"})}),(0,s.jsx)(l.aY,{children:Y.length>0?(0,s.jsx)(B,{data:Y,loading:m,onDrillDown:(e,t)=>{console.log("Drill down:",e,t)}}):(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No subcategory data available"})})]})]}),P.length>0&&(0,s.jsx)(z,{promises:P,currentDate:new Date,onDateClick:(e,t)=>{console.log("Date clicked:",e,t)},loading:m}),(0,s.jsxs)(l.Zb,{children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Detailed Cost Breakdown"})}),(0,s.jsx)(l.aY,{children:(0,s.jsx)(er,{data:w})})]})]})]}):(0,s.jsx)("div",{className:"container mx-auto p-6",children:(0,s.jsxs)(eN.bZ,{variant:"destructive",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)(eN.Cd,{children:"Project Not Found"}),(0,s.jsx)(eN.X,{children:"The requested project could not be found."})]})})}},90033:function(e,t,a){"use strict";a.d(t,{Cd:function(){return c},X:function(){return o},bZ:function(){return i}});var s=a(2562);a(53121);var r=a(89940),n=a(71202);let l=(0,r.j)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(l({variant:a}),t),...r})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,n.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}},34020:function(e,t,a){"use strict";a.d(t,{C:function(){return c}});var s=a(2562);a(53121);var r=a(35737),n=a(89940),l=a(71202);let i=(0,n.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:a,asChild:n=!1,...c}=e,o=n?r.g7:"span";return(0,s.jsx)(o,{"data-slot":"badge",className:(0,l.cn)(i({variant:a}),t),...c})}},61997:function(e,t,a){"use strict";a.d(t,{d:function(){return i},z:function(){return c}});var s=a(2562);a(53121);var r=a(35737),n=a(89940),l=a(71202);let i=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:t,variant:a,size:n,asChild:c=!1,...o}=e,d=c?r.g7:"button";return(0,s.jsx)(d,{"data-slot":"button",className:(0,l.cn)(i({variant:a,size:n,className:t})),...o})}},66237:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return n},aY:function(){return o},ll:function(){return i}});var s=a(2562);a(53121);var r=a(71202);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...a})}},56092:function(e,t,a){"use strict";a.d(t,{E:function(){return l}});var s=a(2562);a(53121);var r=a(90876),n=a(71202);function l(e){let{className:t,value:a,...l}=e;return(0,s.jsx)(r.fC,{"data-slot":"progress",className:(0,n.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...l,children:(0,s.jsx)(r.z$,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}},16832:function(e,t,a){"use strict";a.d(t,{O:function(){return n}});var s=a(2562),r=a(71202);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...a})}},23482:function(e,t,a){"use strict";a.d(t,{RM:function(){return i},SC:function(){return c},iA:function(){return n},pj:function(){return d},ss:function(){return o},xD:function(){return l}});var s=a(2562);a(53121);var r=a(71202);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("[&_tr]:border-b",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}},40814:function(e,t,a){"use strict";a.d(t,{pm:function(){return m}});var s=a(53121);let r=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],o={toasts:[]};function d(e){o=i(o,e),c.forEach(e=>{e(o)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=s.useState(o);return s.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},62680:function(e,t,a){"use strict";a.d(t,{e:function(){return r}});var s=a(27022);function r(){return(0,s.createBrowserClient)("https://bykrhpaqaxhyfrqfvbus.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5a3JocGFxYXhoeWZycWZ2YnVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NDA5OTYsImV4cCI6MjA3MzUxNjk5Nn0.Yu3MY7eTCgXvA8TPDhCE0z0rgxRngX5iLP9tGwE1Kxw")}},71202:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(70782),r=a(99644);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}}},function(e){e.O(0,[197,22,623,349,307,337,208,945,744],function(){return e(e.s=69551)}),_N_E=e.O()}]);