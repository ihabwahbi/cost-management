{
  "id": "forecast-wizard",
  "version": "1.0.0",
  "name": "Budget Forecast Wizard",
  "description": "Multi-step wizard for creating budget forecast versions with inline editing, new entries, and entry exclusions. Replaces 1,005-line monolithic component with modular Cell architecture.",
  "type": "cell",
  "created": "2025-10-04",
  "migrated_from": "apps/web/components/forecast-wizard.tsx",
  
  "data_contract": {
    "source": "trpc.forecasts.createForecastVersion",
    "inputs": {
      "projectId": "string (uuid)",
      "reason": "string",
      "changes": "Record<string, number | null>",
      "newEntries": "CostBreakdown[]"
    }
  },
  
  "behavioral_assertions": [
    {
      "id": "BA-001",
      "priority": "HIGH",
      "description": "Wizard progresses through steps: review → modify → reason → preview → confirm → success",
      "verification": "Unit test: simulate navigation, verify step progression",
      "test_file": "__tests__/component.test.tsx"
    },
    {
      "id": "BA-002",
      "priority": "CRITICAL",
      "description": "Cannot proceed to reason step without changes (validation prevents progression)",
      "verification": "Unit test: attempt next without changes, verify button disabled",
      "test_file": "__tests__/component.test.tsx"
    },
    {
      "id": "BA-003",
      "priority": "HIGH",
      "description": "Modified items tracked in forecastChanges state with visual badges",
      "verification": "Unit test: modify value, verify badge appears and state updates",
      "test_file": "components/__tests__/forecast-editable-table.test.tsx"
    },
    {
      "id": "BA-004",
      "priority": "CRITICAL",
      "description": "New entry validation prevents zero or negative budget_cost values",
      "verification": "Unit test: submit with budget_cost=0, verify blocked with error",
      "test_file": "components/__tests__/new-entry-form.test.tsx"
    },
    {
      "id": "BA-005",
      "priority": "MEDIUM",
      "description": "Temporary IDs generated for new entries (temp_TIMESTAMP_RANDOM format)",
      "verification": "Unit test: create entry, verify ID matches temp_* pattern",
      "test_file": "components/__tests__/new-entry-form.test.tsx"
    },
    {
      "id": "BA-006",
      "priority": "HIGH",
      "description": "Total forecast calculated correctly including changes, new entries, and exclusions",
      "verification": "Unit test: provide test data, verify calculation matches expected",
      "test_file": "__tests__/calculations.test.tsx"
    },
    {
      "id": "BA-007",
      "priority": "HIGH",
      "description": "Change percentage calculated with division by zero protection",
      "verification": "Unit test: calculate with zero original, verify returns 0 (not NaN or Infinity)",
      "test_file": "__tests__/calculations.test.tsx"
    },
    {
      "id": "BA-008",
      "priority": "CRITICAL",
      "description": "Division by zero protection prevents NaN in change percentage",
      "verification": "Unit test: edge case with zero original budget",
      "test_file": "__tests__/calculations.test.tsx"
    },
    {
      "id": "BA-009",
      "priority": "HIGH",
      "description": "Draft auto-saves to localStorage with 1-second debouncing (Pitfall #1 fix)",
      "verification": "Unit test: rapid changes, verify localStorage writes debounced",
      "test_file": "__tests__/draft-persistence.test.tsx"
    },
    {
      "id": "BA-010",
      "priority": "MEDIUM",
      "description": "Draft expires after 24 hours and is not restored",
      "verification": "Unit test: mock old timestamp, verify draft not restored",
      "test_file": "__tests__/draft-persistence.test.tsx"
    },
    {
      "id": "BA-011",
      "priority": "HIGH",
      "description": "Draft cleared from localStorage on successful save",
      "verification": "Integration test: complete wizard, verify localStorage.removeItem called",
      "test_file": "__tests__/component.test.tsx"
    },
    {
      "id": "BA-012",
      "priority": "HIGH",
      "description": "Inline edit mode activated on value click with Enter/Blur to exit",
      "verification": "Unit test: click value, verify input appears; press Enter, verify exits edit mode",
      "test_file": "components/__tests__/forecast-editable-table.test.tsx"
    }
  ],
  
  "dependencies": {
    "ui": [
      "@/components/ui/wizard/wizard-shell",
      "@/components/ui/wizard/wizard-progress",
      "@/components/ui/dialog",
      "@/components/ui/button",
      "@/components/ui/table",
      "@/components/ui/badge",
      "@/components/ui/alert"
    ],
    "hooks": [
      "@/hooks/use-wizard-navigation",
      "@/hooks/use-forecast-calculations",
      "@/hooks/use-draft-persistence"
    ],
    "utils": [
      "@/lib/budget-utils"
    ],
    "api": [
      "trpc.forecasts.createForecastVersion"
    ]
  },
  
  "complexity": {
    "steps": 6,
    "state_variables": 4,
    "tRPC_queries": 1,
    "tRPC_mutations": 1
  },
  
  "pitfalls_fixed": [
    "Pitfall #1: Debouncing auto-save (80% reduction in localStorage writes)",
    "Pitfall #2: Zero-value budget entry validation (prevents $0 entries)"
  ],
  
  "metadata": {
    "extraction_phases": 5,
    "original_size": "1,005 LOC",
    "current_size": "342 LOC",
    "reduction": "66%",
    "components_extracted": 15,
    "hooks_extracted": 2,
    "utils_extracted": 1,
    "test_coverage": "≥80%",
    "reusable_components": 13
  },
  
  "performance": {
    "target_render_time_ms": 200,
    "localStorage_write_frequency": "~1/second (debounced)",
    "debounce_delay_ms": 1000,
    "write_reduction": "80% (Pitfall #1 fix)"
  }
}
